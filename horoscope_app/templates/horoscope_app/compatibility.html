{% load static %}
<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <!-- ★レスポンシブ対応の viewport 指定 -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- SEO用 meta タグ -->
        <meta name="description" content="AI占星術師アオポンによる二人の相性占いサービス。生年月日、出生時刻、出生地から二人のホロスコープを作成し、相性を占います。">
        <meta name="keywords" content="ホロスコープ, ホロスコープ作成, 占星術, AI占星術, 二人の相性占い">
        <meta name="robots" content="index, follow">
        
        <!-- Canonical タグ（URLが確定している場合） -->
        <link rel="canonical" href="https://aihoroscopeanalysis.com/compatibility">

        <!-- OGPタグ（SNS等でのシェア用） -->
        <meta property="og:title" content="二人の相性占い - AI占星術師アオポン">
        <meta property="og:description" content="生年月日、出生時刻、出生地から二人のホロスコープを作成し、相性を占います。">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://aihoroscopeanalysis.com/compatibility">
        <meta property="og:image" content="{% static 'path/to/horoscope-demo8.png' %}">

        <!-- JSON-LDによる構造化データ -->
        <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "二人の相性占い - AI占星術師アオポン",
        "description": "生年月日、出生時刻、出生地から二人のホロスコープを作成し、相性を占います。",
        "url": "https://aihoroscopeanalysis.com/compatibility"
        }
        </script>

        <title>二人の相性占い - AI占星術師アオポン</title>
        
        <!-- Marked.jsのUMDビルドを読み込む -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <!-- DOMPurifyを読み込む（セキュリティ対策） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.10/purify.min.js"></script>
        
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QL89EXFC"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-V8QL89EXFC');
        </script>

        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "q3kqriyub6");
        </script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9717699132149345"
        crossorigin="anonymous"></script>
        
        <style>
            /* 全体リセット・ベース設定 */
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                /* 例：Google Fonts 等で 'Merriweather' や 'Playfair Display' を読み込んだ上で */
                font-family: 'Merriweather', serif;
                margin: 0;
                background: linear-gradient(135deg, #fdfbfb, #ebedee);
            }

            /* ヘッダー */
            h1 {
                background: linear-gradient(90deg, #2c3e50, #4ca1af);
                color: #fff;
                padding: 20px;
                text-align: center;
                margin: 0;
                width: 100%;
                font-family: 'Playfair Display', serif;  /* 上質な印象のセリフ体 */
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }

            /* メインコンテナー */
            .content-container {
                display: flex; 
                justify-content: space-between;
                gap: 20px;
                padding: 0px;
                /* 画面が狭いときは縦並びに */
                flex-wrap: wrap;
            }

            /* フォーム全体 */
            #horoscope-form {
                flex: 1;
                max-width: 100%;
                background-color: #fff;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
                border: 1px solid #e0e0e0;
            }

            /* テーブルのスタイル */
            #horoscope-form table {
                width: 100%;
                border-collapse: collapse;
            }
            #horoscope-form th, 
            #horoscope-form td {
                padding: 16px 20px;
                border: none;
                border-bottom: 1px solid #e0e0e0;
                text-align: left;
                vertical-align: middle;
            }
            #horoscope-form th {
                background-color: transparent;
                color: #333;
                font-weight: bold;
            }
            #horoscope-form td {
                background-color: #fff;
            }

            /* input, select */
            input, select {
                width: 50%;
                padding: 8px;
                margin-top: 5px;
                box-sizing: border-box;
            }
            input,select {
            /* 高さを小さく設定 */
            height: 30px;
            line-height: 30px;
            
            /* 内側の余白 */
            padding: 0px;
            
            /* フォントサイズ */
            font-size: 16px;
            
            /* 枠線・角丸 */
            border: 1px solid #ccc;
            border-radius: 5px;
            
            /* 背景色 */
            background-color: #fff;
            
            /* iOS等でのデフォルトのスタイル（矢印など）を解除 */
            /* appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none; */
            
            /* レンダリングのためにボックスサイズを指定 */
            box-sizing: border-box;
            }
            #horoscope-form input[type="time"] {
                width: auto; 
                min-width: 100px;
            }

            /* 共通ボタンスタイルの変更 */
            button {
                margin-top: 20px;
                padding: 12px 24px;
                cursor: pointer;
                border-radius: 8px;
                font-size: 16px;
                border: none;
                transition: all 0.3s ease;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            button:hover:not(:disabled) {
                filter: brightness(95%);
                transform: translateY(-2px);
            }

            /* 各ボタンのカラー例 */
            #submit-button7,
            #submit-button8,
            #submit-button17,
            #submit-button18 {
                background: linear-gradient(45deg, #2c3e50, #4ca1af); /* 高級感あるグラデーション */
                color: #fff;
                padding: 14px 28px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, filter 0.3s ease;
            }

            /* スピナーのスタイル */
            .spinner {
                border: 4px solid rgba(0, 0, 0, 0.1);
                border-top: 4px solid #4CAF50; 
                border-radius: 50%;
                width: 24px;
                height: 24px;
                animation: spin 1s linear infinite;
                display: inline-block;
                vertical-align: middle;
                margin-left: 10px;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            /* 結果表示のスタイル */
            #result,
            .result-sample {
                margin-top: 30px;
                padding: 15px;
                border: 1px solid #ccc;
                background-color: #f9f9f9;
                white-space: pre-line;
                font-size: 16px;
                color: #333;
            }
            /* resultDiv 内のリストのスタイルを調整 */
            #result ol,
            #result ul,
            .result-sample ol,
            .result-sample ul {
                margin-left: 1.5em;  /* 必要に応じて数値を調整 */
                padding-left: 0;
            }
            .horoscope-meaning ul {
                margin-left: 1.5em;  /* 必要に応じて数値を調整 */
                padding-left: 0;
            }

            /* エラーメッセージのスタイル */
            #error-message {
                color: red;
                margin-top: 10px;
            }

            /* 小さい説明文 */
            small {
                display: block;
                margin-top: 5px;
                color: #666;
            }

            /* テーブル配置用のラッパ */
            #container-table {
                margin: auto;
                width: 100%;
                max-width: 1000px;
            }

            /**
            * ホロスコープ描画用のコンテナ
            * ここを JavaScript 側で width/height を同じに設定します。
            */
            #chart-container {
                position: relative; /* 惑星ラベルを absolute 配置するため */
                margin: 0 auto;
                /* margin-bottom: 10px; */
                /* CSS 側では width/height を固定しない: JS で動的にセット */
                border: 1px solid #ccc;
                display: none; /* 最初は非表示 */
            }

            /* canvas はJSで (最大1000 x 1000) にします */
            #horoscope-canvas {
                display: block; /* ブロック要素化 */
                width: 100%;    /* ここで #chart-container と同じ幅にフィット */
                height: 100%;   /* 同上 */
                background: #99bbff;
            }

            
            /* モーダル関連 */
            .modal {
                display: none;
                position: fixed; 
                z-index: 1000; 
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%; 
                overflow: auto; 
                background-color: rgba(0, 0, 0, 0.5); 
            }
            .modal-content {
                background-color: #fff;
                margin: 10% auto;
                padding: 5px;
                border: none;
                width: 80%;
                max-width: 700px;
                position: relative;
                border-radius: 12px;
                box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            }
            
            /* モーダル開閉ボタン */
            .open-modal-btn {
                background: linear-gradient(45deg, #2c3e50, #4ca1af); /* 高級感あるグラデーション */
                color: #fff;
                padding: 5px 10px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, filter 0.3s ease;
            }

            .open-modal-btn:hover {
                filter: brightness(95%);
                transform: translateY(-2px);
            }

            /* インプットやチェックボックスを横並びにする簡易レイアウト */
            .input-group {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .checkbox-label {
                display: flex;
                white-space: nowrap;
                gap: 4px;
            }

            /* ★ レスポンシブ（画面幅が768px以下の場合） */
            @media (max-width: 768px) {
                h1 {
                    font-size: 1.2em;
                    padding: 15px;
                }
                .content-container {
                    flex-direction: column;
                    align-items: center;
                }
                #container-table {
                    width: 100%;
                    max-width: 100%;
                }
                #horoscope-form th, 
                #horoscope-form td {
                    padding: 8px;
                    font-size: 0.9em;
                }
                .modal-content {
                    margin: 30% auto 0;
                    width: 90%;
                }
            }
            /* 全体コンテナ */
            .horoscope-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 10px;
            }

            /* ホロスコープ作成ボタン */
            .horoscope-create {
            text-align: center;
            }

            /* コンテナのスタイル */
            .analysis-buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            /* 各ボタン共通のスタイル */
            .analysis-button button {
                padding: 10px 20px;
                font-size: 16px;
                border: none;
                border-radius: 5px;
                color: #fff;
                cursor: pointer;
                transition: background-color 0.3s ease, filter 0.3s ease;
            }
            .analysis-buttons {
            display: flex;
            justify-content: space-evenly; /* 均等にスペースを空ける */
            align-items: center; /* 垂直方向の中央揃え */
            }

            /* 各ボタンを同じ幅にしたい場合 */
            .analysis-button {
            flex: 1;                   /* 各要素の幅を均等に */
            display: flex;
            justify-content: center;   /* 内部のボタンを中央寄せ */
            }
            
            
            /* ホバー時：少し暗めに */
            .analysis-button button:hover:not(:disabled) {
                filter: brightness(90%);
            }
            
            /* disabled状態のスタイル */
            .analysis-button button:disabled {
                background-color: #ddd;
                color: #aaa;
                cursor: not-allowed;
            }
            

            /* 初期状態で非表示のスピナー */
            .spinner {
            display: none;
            }

            
            html, body {
            height: 100%;
            margin: 0;
            }
            @media (max-width: 768px) {
            .analysis-buttons {
                /* 2列レイアウトのため、横並びにして折り返しを許可 */
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between; /* ボタン間のスペースを調整 */
            }
            .analysis-button {
                /* 各ボタンの幅を2列分に（gap分を引いた値） */
                min-width: calc(50% - 10px);
                margin-bottom: 10px;
            }
            }
            /* ページ全体をラップするコンテナ */
            .wrapper {
            flex-direction: column;
            min-height: 100%;
            }
            /* コンテンツエリアは空いたスペースをすべて使う */
            .content {
            flex: 1;
            padding: 0px;
            }
            /* フッター（広告）のスタイル */
            .footer {
            background-color: #f9f9f9;
            text-align: center;
            padding: 10px 0;
            }
            /* 広告バナー全体のスタイル（中央寄せなど） */
            #ad-banner {
            text-align: center;
            margin: 20px auto;
            }
            /* デフォルトではデスクトップ広告を表示 */
            .desktop-ad {
            display: block;
            }
            .mobile-ad {
            display: none;
            }
            /* 画面幅が768px以下の場合はモバイル広告に切り替え */
            @media screen and (max-width: 768px) {
            .desktop-ad {
                display: none;
            }
            .mobile-ad {
                display: block;
            }
            }
            /* 3カラムレイアウト用のスタイル */
            .layout-wrapper {
            display: flex;
            justify-content: center; /* 中央寄せ */
            align-items: flex-start;
            gap: 20px; /* 広告と中央コンテンツの間の隙間 */
            max-width: 1600px; /* コンテンツ全体の最大幅 */
            margin: 0 auto;
            padding: 0px;
            }

            /* 広告エリアのスタイル */
            .side-ad {
            flex: 0 0 250px; /* 固定幅 160px（必要に応じて調整） */
            }

            /* 中央コンテンツエリア */
            .main-content {
            flex: 1;
            background-color: transparent;
            padding: 0px;
            /* border-radius: 12px; */
            /* box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); */
            /* border: 1px solid #e0e0e0; */
            }

            /* レスポンシブ対応：画面幅が768px以下の場合は広告を非表示に */
            @media (max-width: 768px) {
            .layout-wrapper {
                flex-direction: column;
                padding: 10px;
            }
            .side-ad {
                display:flexbox;
            }
            .main-content {
                width: 100%;
            }
            /* 左寄せのサイドバー用（必要に応じて調整） */
            .left-ad {
            float: left;
            width: 100%;                   /* 幅は調整可能 */
            }
            }
            /* サイドバー全体のスタイル */
            .side-ad {
            background-color: #f7f7f7;      /* やわらかい背景色 */
            border: 1px solid #ddd;         /* 薄い枠線 */
            padding: 15px;
            border-radius: 8px;             /* 角を丸く */
            margin: 10px;
            font-family: 'Arial', sans-serif;
            }

            /* 左寄せのサイドバー用（必要に応じて調整） */
            .left-ad {
            float: left;
            /* width: 250px; */
            }

            /* リスト全体のリセット */
            .ad-content ul {
            list-style: none;               /* デフォルトのマーカーを非表示 */
            margin: 0;
            padding: 0;
            }

            /* 各リストアイテムの間隔 */
            .ad-content ul li {
            margin-bottom: 10px;
            }

            /* リンクのスタイル */
            .ad-content ul li a {
            display: block;                 /* リンク全体をブロック要素に */
            text-decoration: none;          /* 下線なし */
            color: #333;
            font-weight: bold;
            padding: 8px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
            }

            /* リンクホバー時のスタイル */
            .ad-content ul li a:hover {
            background-color: #e9e9e9;
            color: #000;
            }

            img {
            max-width: 100%;
            height: auto;
            }
            .container {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            }
            .form-section {
            width: 60%;
            }
            /* 親要素にFlexboxレイアウトを適用 */
            .container {
            display: flex;
            align-items: flex-start; /* 上揃え */
            gap: 20px;
            padding: 20px;
            }
            
            /* 左側：フォーム部分 */
            .form-section {
                flex: 0 0 auto;
            }
            
            .canvas-section {
                width: 40%;
            }
            
            /* キャンバスは初期サイズを400pxとしつつ、親要素に合わせて縮小 */
            canvas {
            width: 386px;
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            }
            
            /* 画面幅が768px以下の場合は縦並びに変更 */
            @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .form-section,
            .canvas-section {
                width: 100%;
            }
            
            /* 必要に応じてフォーム部分の最大幅を指定 */
            .form-section {
                max-width: 400px;
            }
            }
            /* CSS */
            .container-wrapper {
            display: column;         /* 横並びにする */
            justify-content: space-between; /* 必要に応じてスペース調整 */
            gap: 20px;             /* コンテナー間に隙間を作る（オプション） */
            }

            .container {
            flex: 1;               /* 各コンテナーを均等に配置する */
            box-sizing: border-box; /* パディング等を含めた幅の計算 */
            /* 必要に応じて最大幅や最小幅を指定 */
            }
            .site-footer{
            margin-top: 40px;
            padding: 16px 12px;
            border-top: 1px solid #eee;
            background: #fafafa;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            }
            .site-footer a{
            text-decoration: underline;
            }
            .site-footer a:hover{
            opacity: 0.8;
            }
            html, body { height: 100%; }
            body { display: flex; flex-direction: column; }
            .wrapper { flex: 1 0 auto; }
            .site-footer { flex-shrink: 0; }
        </style>
    </head>
    
    <body>
        <div class="wrapper">
            <h1>二人の相性占い - AI占星術師アオポン</h1>
            <div class="layout-wrapper">
                <aside class="side-ad left-ad">
                    <div class="ad-content">
                        <h3>メニュー</h3>
                        <ul>
                            <li><a href="{% url 'horoscope_app:index' %}">無料ホロスコープ作成・占い</a></li>
                            <li><a href="#main">二人の相性占い</a></li>
                            <li><a href="#howtouse">利用方法</a></li>
                            <li><a href="#horoscope-sample">ホロスコープのサンプル（真美子夫人）</a></li>
                            <li><a href="#analysis-sample1">AIによる分析結果のサンプル（真美子夫人と大谷翔平さん）二人の相性</a></li>
                            <li><a href="#analysis-sample2">AIによる分析結果のサンプル（真美子夫人と大谷翔平さん）二人の今後</a></li>
                            <li><a href="#horoscope-meaning">コラム ホロスコープの意味するところ</a></li>
                        </ul>
                        <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3DGHQA+3QW4+5Z6WX" rel="nofollow">
                            <img border="0" width="234" height="60" alt="" src="https://www21.a8.net/svt/bgt?aid=250203147204&wid=003&eno=01&mid=s00000017482001004000&mc=1"></a>
                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3DGHQA+3QW4+5Z6WX" alt="">
                        <a href="https://px.a8.net/svt/ejp?a8mat=44YQRN+23M45E+2VYS+6NETT" rel="nofollow">
                            <img border="0" width="234" height="60" alt="" src="https://www22.a8.net/svt/bgt?aid=250204163127&wid=003&eno=01&mid=s00000013474001117000&mc=1"></a>
                            <img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=44YQRN+23M45E+2VYS+6NETT" alt="">
                        <h3>おすすめ書籍</h3>
                        <ul>
                            <li><a href="https://amzn.to/3WL4DBg">CD-ROM付き いちばんやさしい西洋占星術入門</a></li>
                            <li><a href="https://amzn.to/4guj9V3">五十六謀星もっちぃの西洋占星術講義</a></li>
                            <li><a href="https://amzn.to/3WO5wsV">基礎からわかる 西洋占星術の完全独習: 星々の導きで運命をたどる旅</a></li>
                        </ul>
                    </div>
                </aside>
                <!-- 中央メインコンテンツエリア -->
                <main class="main-content">
                    <!-- コンテンツエリア -->
                    <div class="content">
                        <div class="content-container">
                            
                            <div id="data" style="width: 100%;">
                                <a id="main"></a>
                                <form id="horoscope-form" method="POST" action="#">
                                    {% csrf_token %}
                                    <div class="container-wrapper">
                                        <div class="container">
                                            <div class="form-section">
                                                <div>あなた</div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <th>生年月日</th>
                                                            <td>
                                                                <select name="year1" id="year-select1">
                                                                    {% for year in years %}
                                                                        <option value="{{ year }}">{{ year }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <select name="month1" id="month-select1">
                                                                    {% for month in months %}
                                                                        <option value="{{ month }}">{{ month }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <select name="day1" id="day-select1">
                                                                    {% for day in days %}
                                                                        <option value="{{ day }}">{{ day }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>出生時刻</th>
                                                            <td>
                                                                <div class="input-group">
                                                                    <input type="time" id="time1" name="time1" required />
                                                                    <label for="unknown1" class="checkbox-label">
                                                                        <input type="checkbox" id="unknown1" name="unknown1" />
                                                                        <span style="display: inline;">時刻不明</span>
                                                                    </label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>出生地</th>
                                                            <td>
                                                                <select name="prefecture1" id="prefecture1">
                                                                    <option value="Hokkaido" data-lat="43.06417" data-lon="141.34694">北海道</option>
                                                                    <option value="Aomori" data-lat="40.82444" data-lon="140.74">青森県</option>
                                                                    <option value="Iwate" data-lat="39.70361" data-lon="141.1525">岩手県</option>
                                                                    <option value="Miyagi" data-lat="38.26889" data-lon="140.87194">宮城県</option>
                                                                    <option value="Akita" data-lat="39.71861" data-lon="140.1025">秋田県</option>
                                                                    <option value="Yamagata" data-lat="38.24056" data-lon="140.36333">山形県</option>
                                                                    <option value="Fukushima" data-lat="37.75" data-lon="140.46778">福島県</option>
                                                                    <option value="Ibaraki" data-lat="36.34139" data-lon="140.44667">茨城県</option>
                                                                    <option value="Tochigi" data-lat="36.56583" data-lon="139.88361">栃木県</option>
                                                                    <option value="Gunma" data-lat="36.39111" data-lon="139.06083">群馬県</option>
                                                                    <option value="Saitama" data-lat="35.85694" data-lon="139.64889">埼玉県</option>
                                                                    <option value="Tokyo" data-lat="35.6895" data-lon="139.6917" selected>東京都</option>
                                                                    <option value="Chiba" data-lat="35.60506" data-lon="140.12333">千葉県</option>
                                                                    <option value="Kanagawa" data-lat="35.44778" data-lon="139.6425">神奈川県</option>
                                                                    <option value="Niigata" data-lat="37.90222" data-lon="139.02361">新潟県</option>
                                                                    <option value="Toyama" data-lat="36.69529" data-lon="137.21134">富山県</option>
                                                                    <option value="Ishikawa" data-lat="36.59444" data-lon="136.62556">石川県</option>
                                                                    <option value="Fukui" data-lat="36.06528" data-lon="136.22194">福井県</option>
                                                                    <option value="Yamanashi" data-lat="35.66389" data-lon="138.56833">山梨県</option>
                                                                    <option value="Nagano" data-lat="36.65139" data-lon="138.18111">長野県</option>
                                                                    <option value="Gifu" data-lat="35.39111" data-lon="136.72222">岐阜県</option>
                                                                    <option value="Shizuoka" data-lat="34.97694" data-lon="138.38306">静岡県</option>
                                                                    <option value="Aichi" data-lat="35.18028" data-lon="136.90667">愛知県</option>
                                                                    <option value="Mie" data-lat="34.73028" data-lon="136.50859">三重県</option>
                                                                    <option value="Shiga" data-lat="35.00444" data-lon="135.86833">滋賀県</option>
                                                                    <option value="Kyoto" data-lat="35.02139" data-lon="135.75556">京都府</option>
                                                                    <option value="Osaka" data-lat="34.68639" data-lon="135.52">大阪府</option>
                                                                    <option value="Hyogo" data-lat="34.69139" data-lon="135.18306">兵庫県</option>
                                                                    <option value="Nara" data-lat="34.68528" data-lon="135.83278">奈良県</option>
                                                                    <option value="Wakayama" data-lat="34.22611" data-lon="135.1675">和歌山県</option>
                                                                    <option value="Tottori" data-lat="35.50361" data-lon="134.23833">鳥取県</option>
                                                                    <option value="Shimane" data-lat="35.47222" data-lon="133.05056">島根県</option>
                                                                    <option value="Okayama" data-lat="34.66167" data-lon="133.935">岡山県</option>
                                                                    <option value="Hiroshima" data-lat="34.39639" data-lon="132.45962">広島県</option>
                                                                    <option value="Yamaguchi" data-lat="34.18583" data-lon="131.47139">山口県</option>
                                                                    <option value="Tokushima" data-lat="34.06583" data-lon="134.55944">徳島県</option>
                                                                    <option value="Kagawa" data-lat="34.34028" data-lon="134.04333">香川県</option>
                                                                    <option value="Ehime" data-lat="33.84167" data-lon="132.76556">愛媛県</option>
                                                                    <option value="Kochi" data-lat="33.55972" data-lon="133.53108">高知県</option>
                                                                    <option value="Fukuoka" data-lat="33.60639" data-lon="130.41806">福岡県</option>
                                                                    <option value="Saga" data-lat="33.24944" data-lon="130.29889">佐賀県</option>
                                                                    <option value="Nagasaki" data-lat="32.74472" data-lon="129.87361">長崎県</option>
                                                                    <option value="Kumamoto" data-lat="32.78972" data-lon="130.74167">熊本県</option>
                                                                    <option value="Oita" data-lat="33.23806" data-lon="131.6125">大分県</option>
                                                                    <option value="Miyazaki" data-lat="31.91111" data-lon="131.42389">宮崎県</option>
                                                                    <option value="Kagoshima" data-lat="31.56028" data-lon="130.55806">鹿児島県</option>
                                                                    <option value="Okinawa" data-lat="26.2125" data-lon="127.68111">沖縄県</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                                <button type="button" id="draw-button1" class="open-modal-btn">ホロスコープを作成</button>
                                                <button type="button" id="view-button1" class="open-modal-btn">ホロスコープの詳細</button>
                                            </div>
                                            
                                            <div class="canvas-section">
                                                <div id="chart-container1">
                                                    <canvas id="horoscope-canvas1"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 緯度/経度 (自動セット) -->
                                        <input type="hidden" step="0.0001" name="lat1" id="lat1" required readonly>
                                        <input type="hidden" step="0.0001" name="lon1" id="lon1" required readonly>
                                        <input type="hidden" step="0.1" name="tz1" required value="9.0">
                                        <input type="hidden" step="0.1" name="dst1" required value="0.0">
                                        <div id="error-message"></div>
                                        <div class="container">
                                            <div class="form-section">
                                                <div>お相手</div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <th>生年月日</th>
                                                            <td>
                                                                <select name="year2" id="year-select2">
                                                                    {% for year in years %}
                                                                        <option value="{{ year }}">{{ year }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <select name="month2" id="month-select2">
                                                                    {% for month in months %}
                                                                        <option value="{{ month }}">{{ month }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <select name="day2" id="day-select2">
                                                                    {% for day in days %}
                                                                        <option value="{{ day }}">{{ day }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>出生時刻</th>
                                                            <td>
                                                                <div class="input-group">
                                                                    <input type="time" id="time2" name="time2" required />
                                                                    <label for="unknown2" class="checkbox-label">
                                                                        <input type="checkbox" id="unknown2" name="unknown2" />
                                                                        <span style="display: inline;">時刻不明</span>
                                                                    </label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>出生地</th>
                                                            <td>
                                                                <select name="prefecture2" id="prefecture2">
                                                                    <option value="Hokkaido" data-lat="43.06417" data-lon="141.34694">北海道</option>
                                                                    <option value="Aomori" data-lat="40.82444" data-lon="140.74">青森県</option>
                                                                    <option value="Iwate" data-lat="39.70361" data-lon="141.1525">岩手県</option>
                                                                    <option value="Miyagi" data-lat="38.26889" data-lon="140.87194">宮城県</option>
                                                                    <option value="Akita" data-lat="39.71861" data-lon="140.1025">秋田県</option>
                                                                    <option value="Yamagata" data-lat="38.24056" data-lon="140.36333">山形県</option>
                                                                    <option value="Fukushima" data-lat="37.75" data-lon="140.46778">福島県</option>
                                                                    <option value="Ibaraki" data-lat="36.34139" data-lon="140.44667">茨城県</option>
                                                                    <option value="Tochigi" data-lat="36.56583" data-lon="139.88361">栃木県</option>
                                                                    <option value="Gunma" data-lat="36.39111" data-lon="139.06083">群馬県</option>
                                                                    <option value="Saitama" data-lat="35.85694" data-lon="139.64889">埼玉県</option>
                                                                    <option value="Tokyo" data-lat="35.6895" data-lon="139.6917" selected>東京都</option>
                                                                    <option value="Chiba" data-lat="35.60506" data-lon="140.12333">千葉県</option>
                                                                    <option value="Kanagawa" data-lat="35.44778" data-lon="139.6425">神奈川県</option>
                                                                    <option value="Niigata" data-lat="37.90222" data-lon="139.02361">新潟県</option>
                                                                    <option value="Toyama" data-lat="36.69529" data-lon="137.21134">富山県</option>
                                                                    <option value="Ishikawa" data-lat="36.59444" data-lon="136.62556">石川県</option>
                                                                    <option value="Fukui" data-lat="36.06528" data-lon="136.22194">福井県</option>
                                                                    <option value="Yamanashi" data-lat="35.66389" data-lon="138.56833">山梨県</option>
                                                                    <option value="Nagano" data-lat="36.65139" data-lon="138.18111">長野県</option>
                                                                    <option value="Gifu" data-lat="35.39111" data-lon="136.72222">岐阜県</option>
                                                                    <option value="Shizuoka" data-lat="34.97694" data-lon="138.38306">静岡県</option>
                                                                    <option value="Aichi" data-lat="35.18028" data-lon="136.90667">愛知県</option>
                                                                    <option value="Mie" data-lat="34.73028" data-lon="136.50859">三重県</option>
                                                                    <option value="Shiga" data-lat="35.00444" data-lon="135.86833">滋賀県</option>
                                                                    <option value="Kyoto" data-lat="35.02139" data-lon="135.75556">京都府</option>
                                                                    <option value="Osaka" data-lat="34.68639" data-lon="135.52">大阪府</option>
                                                                    <option value="Hyogo" data-lat="34.69139" data-lon="135.18306">兵庫県</option>
                                                                    <option value="Nara" data-lat="34.68528" data-lon="135.83278">奈良県</option>
                                                                    <option value="Wakayama" data-lat="34.22611" data-lon="135.1675">和歌山県</option>
                                                                    <option value="Tottori" data-lat="35.50361" data-lon="134.23833">鳥取県</option>
                                                                    <option value="Shimane" data-lat="35.47222" data-lon="133.05056">島根県</option>
                                                                    <option value="Okayama" data-lat="34.66167" data-lon="133.935">岡山県</option>
                                                                    <option value="Hiroshima" data-lat="34.39639" data-lon="132.45962">広島県</option>
                                                                    <option value="Yamaguchi" data-lat="34.18583" data-lon="131.47139">山口県</option>
                                                                    <option value="Tokushima" data-lat="34.06583" data-lon="134.55944">徳島県</option>
                                                                    <option value="Kagawa" data-lat="34.34028" data-lon="134.04333">香川県</option>
                                                                    <option value="Ehime" data-lat="33.84167" data-lon="132.76556">愛媛県</option>
                                                                    <option value="Kochi" data-lat="33.55972" data-lon="133.53108">高知県</option>
                                                                    <option value="Fukuoka" data-lat="33.60639" data-lon="130.41806">福岡県</option>
                                                                    <option value="Saga" data-lat="33.24944" data-lon="130.29889">佐賀県</option>
                                                                    <option value="Nagasaki" data-lat="32.74472" data-lon="129.87361">長崎県</option>
                                                                    <option value="Kumamoto" data-lat="32.78972" data-lon="130.74167">熊本県</option>
                                                                    <option value="Oita" data-lat="33.23806" data-lon="131.6125">大分県</option>
                                                                    <option value="Miyazaki" data-lat="31.91111" data-lon="131.42389">宮崎県</option>
                                                                    <option value="Kagoshima" data-lat="31.56028" data-lon="130.55806">鹿児島県</option>
                                                                    <option value="Okinawa" data-lat="26.2125" data-lon="127.68111">沖縄県</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                                <button type="button" id="draw-button2" class="open-modal-btn">ホロスコープを作成</button>
                                                <button type="button" id="view-button2" class="open-modal-btn">ホロスコープの詳細</button>
                                            </div>
                                            
                                            <div class="canvas-section">
                                                <div id="chart-container2">
                                                    <canvas id="horoscope-canvas2"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 緯度/経度 (自動セット) -->
                                        <input type="hidden" step="0.0001" name="lat2" id="lat2" required readonly>
                                        <input type="hidden" step="0.0001" name="lon2" id="lon2" required readonly>
                                        <input type="hidden" step="0.1" name="tz2" required value="9.0">
                                        <input type="hidden" step="0.1" name="dst2" required value="0.0">
                                        <div id="error-message"></div>
                                    </div>
                                    
                                    <div class="horoscope-container">
                                        <hr>
                                        <div style="text-align: center;">
                                            <span>以下から占いたい項目を選んでください。<br>AI占星術師アオポンがあなたのホロスコープから占います。</span>
                                        </div>
                                        <hr>
                                        <h3>占い</h3>
                                        <!-- 占いボタン群 -->
                                        <div class="analysis-buttons">
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button7">二人の相性</button>
                                                <div id="spinner7" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button8">二人の今後</button>
                                                <div id="spinner8" class="spinner"></div>
                                            </div>
                                        </div>
                                        <small>※AIがその都度鑑定を行うため、30秒~3分ほどかかります。</small>
                                        <br>
                                        <hr>
                                        <h3>質問確認</h3>
                                        <!-- 占いボタン群 -->
                                        <div class="analysis-buttons">
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button17">二人の相性</button>
                                                <div id="spinner17" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button18">二人の今後</button>
                                                <div id="spinner18" class="spinner"></div>
                                            </div>
                                        </div>
                                        <small>※質問は即座に表示されます。</small>
                                    </div>
                                    <h3>
                                        回答・質問表示欄
                                        <!-- コピー ボタン -->
                                        <button id="copyBtn">コピー</button>
                                    </h3>
                                    <!-- 占い結果表示 -->
                                    <div id="result">AIの回答がここに表示されます</div>
                                    
                                    <hr>
                                    <div id="ad-banner">
                                        <div class="desktop-ad">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+8KELOI+2PEO+C4LLD" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250202141518&wid=003&eno=01&mid=s00000012624002037000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www12.a8.net/0.gif?a8mat=44YP7H+8KELOI+2PEO+C4LLD" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www21.a8.net/svt/bgt?aid=250202141788&wid=003&eno=01&mid=s00000012624008024000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www16.a8.net/0.gif?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250203147212&wid=003&eno=01&mid=s00000012748002004000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" alt="">
                                        </div>
                                        <div class="mobile-ad">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+8KELOI+2PEO+C4LLD" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250202141518&wid=003&eno=01&mid=s00000012624002037000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www12.a8.net/0.gif?a8mat=44YP7H+8KELOI+2PEO+C4LLD" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www21.a8.net/svt/bgt?aid=250202141788&wid=003&eno=01&mid=s00000012624008024000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www16.a8.net/0.gif?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250203147212&wid=003&eno=01&mid=s00000012748002004000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" alt="">
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <hr>
                                    <a id="howtouse"></a>
                                    <div>
                                        <h3>このサイトの利用方法</h3>
                                        <div>
                                            <p>1.占いたい人の生年月日、出生時刻、出生地を入力します。（出生時刻が分からない場合は不明にチェックを入れてください。）</p>
                                            <p>2.ホロスコープを作成ボタンからホロスコープを作成できます。</p>
                                            <p>3.ホロスコープの詳細を見たい場合は、ホロスコープの詳細ボタンを押してください。大きなホロスコープを見ることができます。</p>
                                            <p>4.その後、占いたい項目(相性、今後)を2つのボタンから選択してください。</p>
                                            <p>5.ボタンを押すとAIが<strong>惑星の配置だけに基づいて</strong>、解析結果を占ってくれます。</p>
                                            <p>この解析結果の作成にはOpenAIのAPIを利用しています。</p>
                                        </div>
                                        <br>
                                        <br>
                                        <hr>
                                        <h3>AIを使ったオーダーメイドな使い方</h3>
                                        <div>
                                            <p>1.占いたい人の生年月日、出生時刻、出生地を入力します。（出生時刻が分からない場合は不明にチェックを入れてください。）</p>
                                            <p>2.質問確認から知りたい質問を押します。</p>
                                            <p>3.コピーボタンを押します。</p>
                                            <p>4.ChatGPT、Grok、Geminiなどにアクセスします。</p>
                                            <p>5.コピーした文章を張り付けて質問すると答えてくれます。</p>
                                            <p>6.チャット形式なので、他にも聞きたいことを続けて聞くことができます。自分の聞きたいAIに自分の好きな質問ができます。</p>
                                            <p>おすすめはOpenAIのGPT-4oです。また、Grok3も比較的正確に返してくれます。</p>
                                        </div>
                                    </div>
                                    <div id="ad-banner">
                                        <div class="desktop-ad">
                                        </div>
                                        <div class="mobile-ad">
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="horoscope-sample"></a>
                                    <hr>
                                    <div>
                                        <h3>ホロスコープのサンプル（大谷翔平さんの奥さんの真美子夫人）</h3>
                                        <div>
                                            <p>以下に例として1996/12/11 東京都生まれの大谷翔平さんの奥さんの真美子夫人のホロスコープのサンプルを表示します。</p>
                                        </div>
                                        <div style="text-align: center;">
                                            <img src="{% static 'path/to/horoscope-mamiko.png' %}" alt="horoscope demo image">
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="analysis-sample1"></a>
                                    <hr>
                                    <div>
                                        <h3>AIによる分析結果のサンプル（真美子夫人と大谷翔平さん）二人の相性</h3>
                                        <div>
                                            <p>同様に例として大谷翔平さんと真美子夫人の二人の相性を占った結果を載せます。</p>
                                            <p>このように分かりやすい解析結果が得られます。</p>
                                        </div>
                                    </div>
                                    <div  id="result-sample1" class="result-sample">
                                        <p>下記は双方の太陽・月・惑星の配置や、それぞれの個性・エネルギーの傾向から読み取れる相性の傾向になります。なお、あなたの出生時刻不明のため、アセンダントやハウス・MCなどの情報は考慮せず、各惑星のサインや、両者が持つ共通する世代的テーマ・エネルギー、そして主要な天体間の関連性を踏まえた解釈となります。</p>
                                        <p>─────────────────────────────
                                        【基本的な個性とエネルギーの傾向】</p>
                                        <p>◆あなた（A）の特徴<br>・太陽・月・冥王星が射手座や乙女座、蠍座など、火と柔軟なエネルギーで表現される配置が多く出ています。これは、冒険心・楽観性・探究心を持ちつつ、内面では深い情熱や自己改革への意欲があることを示します。また、金星が蠍座にあることで、恋愛や愛情表現に一途で深い愛情を注ぐ傾向が見られます。<br>・また、水星や木星、海王星などが山羊座に位置しているため、実務的で堅実な一面も持ち、目標に向かって計画的に進む力も備えています。</p>
                                        <p>◆お相手（B）の特徴<br>・お相手は太陽が蟹座、月が双子座、金星が獅子座など、感情面では繊細かつ情感豊かでありながら、知的好奇心やコミュニケーションを大切にする面が強調されています。<br>・また、水星や火星が双子座にあることから、情報交換や対話を通して活発に動く傾向があり、また柔軟で多才なアイディアが生まれやすい配置です。<br>・世代的な惑星（天王星、海王星、冥王星）も、お相手は山羊座や蠍座に集まっており、現実的な一面と深い感情の領域を備えています。</p>
                                        <p>─────────────────────────────
                                        【お互いのエネルギーの接点と共通点】</p>
                                        <ol>
                                        <li><p>共通の実務性・現実感<br>　・あなたの水星、木星、海王星の山羊座配置と、お相手の世代的な配置で見られる山羊座（天王星・海王星共通）からは、物事を現実的かつ計画的に運ぶ意識が垣間見えます。この共通点は、生活の基盤や将来のビジョンについて意見を交換するときに役立つでしょう。</p>
                                        </li>
                                        <li><p>世代的エネルギーの一致<br>　・両者とも、海王星が共に山羊座にあり、また天王星やその他の世代惑星も似た境遇にあるため、社会的な価値観や大きな夢、理想へのアプローチに共感しやすい点があり、長期的な付き合いにおいて互いの目指す方向性を理解する基盤になります。</p>
                                        </li>
                                        <li><p>異なる感情表現<br>　・あなたは射手座的な明るさ・楽観性を、またお相手は蟹座の感受性や家庭的な温もりを持っています。お互いの「火」と「水」の性質は、最初は引き合う魅力となる一方で、意見の食い違いや歩み寄りが必要な部分もあるでしょう。</p>
                                        </li>
                                        </ol>
                                        <p>─────────────────────────────
                                        【注意すべき点・潜在的なチャレンジ】</p>
                                        <ol>
                                        <li><p>恋愛感情と愛情表現の違い<br>　・あなたの金星が蠍座にあるのに対し、お相手の金星は獅子座です。蠍座は本質や内面の深い絆を求める傾向があるのに対し、獅子座はドラマチックで情熱的、かつ賞賛されたいという欲求が強いので、愛情表現や恋愛のアプローチにおいて、時に互いの価値観のズレが現れる可能性があります。</p>
                                        </li>
                                        <li><p>コミュニケーションの違い<br>　・お相手は双子座に複数の惑星（例：月や水星、火星）があるため、対話や軽快な情報の交換を重視します。一方、あなたは火星や冥王星などで示される深い情熱や本質的な探求心が強調されるため、会話のスピードや深さで多少のギャップを感じる場合があるかもしれません。<br>　　しかし、この違いは、対話の中で「違う視点」を学び合うチャンスにもなります。お互いのペースやアプローチを理解し、譲り合いながら進めることが大切です。</p>
                                        </li>
                                        <li><p>対価的な価値観や責任感<br>　・あなたの配置には堅実さと計画性が見られますが、それに対して、お相手は家庭的で情緒豊かな一面を持っています。生活面や未来設計に関して、実務的な側面と感情的な側面のバランスをどう取るか、意識の違いが現れることも考えられます。</p>
                                        </li>
                                        </ol>
                                        <p>─────────────────────────────
                                        【全体的な相性のまとめとアドバイス】</p>
                                        <p>・基本的には、あなたの冒険心・実務的な堅実さと、お相手の感受性・コミュニケーション重視のエネルギーは、互いに補完し合える可能性を秘めています。<br>・共通する現実感や将来へのビジョンは、長期的なパートナーシップの基盤となるでしょう。特に、両者で共有できる社会的価値観や世代的なテーマが、協力・共鳴のポイントとなります。<br>・一方で、恋愛面では、あなたの深い情熱と執着、お相手の華やかさや自己主張が時折衝突する可能性も。こうしたときは、相手の違った愛情表現を尊重し、お互いの価値観や求めるものを率直に語る場が必要です。<br>・コミュニケーションにおいては、情報のスピードや深さに差が生じることも考えられますが、その違いを「新しい学び」として捉え、互いのスタイルを理解し合う努力が大切です。</p>
                                        <p>結論として、双方には吸引力や相補性が働く一方、違いから生じるチャレンジも存在します。お互いの特性を理解し、譲り合いながらコミュニケーションを重ねることで、関係は調和と成長を遂げる可能性が高いと言えます。</p>
                                        <p>─────────────────────────────
                                        以上、両者の天体配置から読み取れる相性の傾向となります。異なる個性を受け入れ、補い合える関係作りが、二人の未来を明るいものにしていく鍵となるでしょう。</p>
                                    </div>
                                    
                                    <br>
                                    <br>
                                    <a id="analysis-sample2"></a>
                                    <hr>
                                    <div>
                                        <h3>AIによる分析結果のサンプル（真美子夫人と大谷翔平さん）二人の今後</h3>
                                        <div>
                                            <p>続けて例として大谷翔平さんの仕事運を占った結果を載せます。</p>
                                            <p>このように分かりやすい解析結果が得られます。</p>
                                        </div>
                                    </div>

                                    <div id="result-sample2" class="result-sample"><p>以下は、両者の天体配置や内側のアスペクトから読み取れる傾向をもとにした、未来への示唆です。なお、ご質問のとおり、あなたの出生時刻が不明なことから、アセンダント・MC・ハウスの情報は考慮せず、惑星のサインやそれぞれの内側のアスペクト、性質などから読み解いた総合的な見解となります。</p>
                                        <p>──────────────────────────────
                                        【１．基本的なパーソナリティの違いと共通点】</p>
                                        <p>●あなた（まずは「私」とします）<br>　・太陽と月が射手座にあるため、自由や冒険、理想への探究心が強い一方、楽観的で大らかな性質が現れています。<br>　・金星が蠍座にあるため、恋愛面では情熱的で深い絆を求め、時に強い執着や内面の変容を伴う関係を望む傾向があります。<br>　・火星が乙女座にあることから、行動面では几帳面さや実務的な面が伺え、時に細部にこだわりすぎる面もあるかもしれません。  </p>
                                        <p>●お相手<br>　・太陽が蟹座にあり、感受性や家庭的な温かみ、保護本能が強いと考えられます。<br>　・月が双子座、そして水星が双子座に近い位置にあるため、コミュニケーションや知的な刺激をとても大切にし、変化を楽しむ柔軟性が感じられます。<br>　・金星が獅子座にあることから、恋愛表現は派手で誇り高く、自己表現を大切にする傾向があります。</p>
                                        <p>──────────────────────────────
                                        【２．相性や相互作用のポイント】</p>
                                        <p>◆感情・心のつながり<br>　・あなたの太陽・月（射手座）のエネルギーは、自由で広がりのある感情表現を示します。一方で、お相手の太陽（蟹座）は、家族や安心感、共感を大事にする傾向があるため、初めは「遠くから感じる温かさ」や安心感の違いが存在する可能性があります。<br>　・また、あなたの月が射手座と、お相手の月が双子座という配置は、どちらも知的で好奇心旺盛な性質を持っているため、共に学び合う姿勢や互いに刺激し合う関係が生まれやすいでしょう。ただし、射手座は大局的、双子座は細やかという違いから、感じ方にズレが生じることもあるかもしれません。</p>
                                        <p>◆恋愛・情熱の表れ方<br>　・あなたの金星が蠍座で、情熱的で深い愛の変容を求める一方、お相手の金星が獅子座にあるため、愛情表現はよりドラマティックで自己中心的な面が出やすいです。<br>　・特に、あなたの内面的な愛情が、時に抑えがたい激情として現れるのに対し、お相手は自分の誇りや表現を大切にするので、恋愛面では「激しさ」と「自己主張」がぶつかる局面があり、情熱的でありながらも、時にパワー・バランスの調整が必要になるでしょう。</p>
                                        <p>◆知性とコミュニケーション<br>　・お相手の月や水星が双子座で、知的な交流を重視するため、会話や情報の交換を通して心のつながりが育まれやすいです。<br>　・一方、あなたの火星や水星は地のサイン（乙女座、山羊座）で安定志向や現実的なアプローチが求められる傾向があるため、会話自体は目的志向になることも。そのため、どちらにとっても「もっと感情的な共感」や「互いの内面をじっくり受け止める時間」が大切になってくるでしょう。</p>
                                        <p>◆内面的な成長と対立の可能性<br>　・あなたのチャート内では、太陽や月が火星とスクエア（90度前後の緊張）を形成しているため、内面の衝動や行動面での摩擦が起こりやすい印象です。これが、時に自己主張や感情の爆発となって表れることも。<br>　・お相手のチャートでも、火星と冥王星のオポジション、金星と冥王星のスクエアなど、関係性におけるパワー・ダイナミクスや変容のテーマが現れています。これらは、刺激的であると同時に、対立や支配・被支配といった課題を生じやすい要素です。<br>　・両者とも内面に揺れやすい部分を持っているため、対立が起きた際には、お互いの感情や意志の強さがぶつかり合い、時には激しい衝突へと発展する可能性もあります。しかし、この緊張関係は、双方が自己を見つめ直し、成長するための「試練」として働くことも期待されます。</p>
                                        <p>──────────────────────────────
                                        【３．未来への示唆】</p>
                                        <p>◆魅惑的な出会いと変容の可能性<br>　・初めはお互いの違い（自由を求める射手座対、保護や安心を求める蟹座、加えて金星の表現の違い）から、一種の「反発しあいながらも引き寄せ合う」感覚が働き、非常に魅惑的な出会いや恋愛関係が展開されるでしょう。<br>　・特に、あなたの秘めた情熱（蠍座の金星）と、お相手の内面に潜む本気度や変革のエネルギー（冥王星との関係）によって、両者の関係は単なる表面的なものではなく、深い意味での変容や再生を迎える可能性があります。</p>
                                        <p>◆成長と調整のプロセス<br>　・今後の関係の中で、衝突や緊張が訪れる局面もあるでしょう。たとえば、あなた自身の内側の衝動（太陽や月と火星とのスクエア）や、お相手の情熱と自己主張（獅子座の金星や、火星・冥王星のオポジション）が、意見の食い違いや感情のぶつかり合いとして現れる場合があります。<br>　・しかし、こうした摩擦は、どちらか一方だけでなく、互いに歩み寄り、相手の内面を尊重し理解するチャンスともなります。時間をかけて対話や自己反省を重ねることで、両者は関係の中に真の信頼や深い絆を築いていくことができるでしょう。</p>
                                        <p>◆柔軟性と創造的なアプローチ<br>　・お相手の双子座系のエネルギー（コミュニケーションに長けた月・水星）と、あなたの冒険心・理想を象徴する射手座の影響は、双方に柔軟性や学びへの意欲をもたらします。これを生かし、変化するライフステージや環境にあわせながら、互いに支え合う関係を模索することが未来の課題です。<br>　・また、感情や情熱の高まりが起こったときには、冷静に内省する時間を持つことや、共通の趣味やプロジェクトを通して建設的なエネルギーに変換していく工夫が、関係の持続に大いに寄与するでしょう。</p>
                                        <p>──────────────────────────────
                                        【４．総合的な展望】</p>
                                        <p>・両者は、初めは（または交際が始まったとき）強烈な引力と刺激を感じやすく、特に情熱面では深い魅力を持つ組み合わせです。しかし、その一方で、内面の強い意思や感情のぶつかり合いが、止めどない衝突として現れる可能性もはらんでいます。<br>・今後の展開では、互いに自分自身の内面と向き合いながら、相手の違いを受け入れる努力や、妥協と対話を重ねるプロセスが大切になるでしょう。<br>・もし、両者とも成長と変容を自らのテーマとして捉え、感情の高ぶりを建設的なエネルギーに変換できれば、この関係は長期的に見ると、お互いに大きな影響を与えあい、自己実現や人生の大きな転換点となる、貴重なパートナーシップへと昇華していくと考えられます。</p>
                                        <p>──────────────────────────────
                                        結論として、あなたとお相手は極めて魅力的で情熱的な関係をスタートさせる可能性がある一方、内面の衝突や価値観のズレから、時に困難な局面にも見舞われるかもしれません。しかし、それらの試練を乗り越える過程で、双方が深い学びと変容を経験し、最終的にはより成熟した絆や信頼関係を築くチャンスに恵まれるでしょう。お互いの違いを理解し、尊重し合うための対話と柔軟性が、未来を輝かせる鍵となるでしょう。</p>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="horoscope-meaning"></a>
                                    <hr>
                                    <div>
                                        <div class="horoscope-meaning">
                                            <h3>コラム</h3>
                                            <h3>ホロスコープの意味するところ：天体が映し出すあなた自身の物語</h3>

                                            <p>占星術は、太古の昔から星々の運行を通じて人間の営みを読み解こうとしてきました。</p>
                                            <p>現代においても、ホロスコープは単なる未来予測の道具ではなく、自己理解と人生の指針を与えてくれる大切なコンパスとなっています。</p>
                                            <p>ここでは、ホロスコープが意味するところについて、その深い背景と実践的な意義を探ってみたいと思います。</p>
                                            <br>

                                            <h4>1. 天体の配置が示す「宇宙との対話」</h4>
                                            <p>ホロスコープは、誕生の瞬間における天体の位置を基に作成されます。太陽、月、惑星、アセンダントといった天体の配置は、個々の性格、才能、潜在的な課題や人生のテーマを象徴するとされています。これらは、宇宙があなたに与えた「プログラム」のようなものであり、どの天体がどの星座に位置しているか、またその天体同士がどのようなアスペクト（角度）を形成しているかは、あなたの内面世界や外部との関係性を映し出す鏡です。</p>
                                            <br>
                                            <h4>2. ホロスコープは未来を予言するのではなく、内面への気づきを促す</h4>
                                            <p>よく誤解される点として、ホロスコープは「運命を決定する未来予知ツール」というイメージがあります。しかし、占星術の真髄は、あくまで自己理解と成長のためのガイドラインにあります。天体の動きは、あくまであなたが持つ可能性や傾向を示すものであり、未来は常に変化しうるものです。ホロスコープは、どんな困難な時も「内面に目を向け、自己改革を促すチャンス」として活用することで、より充実した人生を歩むためのヒントとなります。</p>
                                            <br>
                                            <h4>3. 各天体と星座が語るあなたの物語</h4>
                                            <ul>
                                                <li>太陽は、あなたの中心的なエネルギーと本質を示し、ライフパーパス（生きる意味）に深く関わります。</li>
                                                <li>月は、内面の感情や無意識、心の反応を映し出し、情緒的な側面を理解する鍵となります。</li>
                                                <li>水星は、思考やコミュニケーションのスタイルを表し、知性や情報処理の在り方に光を当てます。</li>
                                                <li>金星は、愛情、価値観、美意識といった、心の豊かさに関連するテーマを象徴します。</li>
                                                <li>火星は、行動力や情熱、エネルギーの発散を示し、あなたがどのように目標に向かって突き進むかを描き出します。</li>
                                            </ul>
                                        
                                            <p>各惑星が属する星座は、その天体の性質に色を添え、どのような方法でそれらのエネルギーが表現されるかを示します。また、ハウス（宮）の位置は、天体が人生のどの分野に影響を及ぼすかを具体的に明らかにします。</p>
                                            <br>

                                            <h4>4. 自己理解への道しるべとしてのホロスコープ</h4>
                                            <p>ホロスコープは、自己探求の旅において大変貴重なツールです。例えば、苦難や試練の時期が訪れると、ホロスコープはその背景にある潜在的なパターンを読み解く助けとなります。そして、どのような課題に取り組むべきか、どの分野で成長が期待できるかといった、人生の「羅針盤」として活用することができるのです。</p>
                                            
                                            <p>また、ホロスコープは他者との関係性（シナストリー）を読み解くためにも利用されます。人間関係における相性や、互いのエネルギーがどのように交錯しているのかを知ることで、対人関係の改善や円滑なコミュニケーションに繋がります。</p>
                                            <br>
                                            <h4>5. 結びに</h4>
                                            <p>ホロスコープは、星々の神秘的な運行を通じてあなた自身の内面や人生のテーマを浮かび上がらせる、奥深い自己理解のツールです。決して未来を固定的に示すものではなく、あなたがどのように生き、どのように成長するかの可能性を示唆するガイドラインです。星々が紡ぐ物語に耳を傾け、その声に導かれながら、自分自身の本当の姿を見つけ出す旅に出てみてはいかがでしょうか。</p>
                                            
                                            <p>このコラムが、あなた自身のホロスコープに秘められた意味を探る一助となり、内なる光を見出すヒントとなることを願っています。</p>
                                        </div>
                                    </div>

                                </form>


                            </div>
                            
                            
                        </div>
                    </div>
                </main>
            </div> <!-- .layout-wrapper -->
            
            <footer class="site-footer">
                <p>
                    © {% now "Y" %} AI占星術師アオポン —
                    <a href="https://github.com/YutaAoyagi2018/aihoroscope" target="_blank" rel="noopener noreferrer">
                        GitHubでソースを見る
                    </a>
                </p>
            </footer>
        </div>

        <script>
        // 既存の getCookie があればそのままでOK（無ければ下を使用）
        function getCookie(name) {
            const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
            return m ? decodeURIComponent(m.pop()) : '';
        }

        // prefix = "1" or "2"
        function buildParamsFromForm(prefix) {
            const form = document.getElementById('horoscope-form');
            const fd = new FormData(form);
            const year  = fd.get('year' + prefix);
            const month = fd.get('month' + prefix);
            const day   = fd.get('day' + prefix);
            const time  = fd.get('time' + prefix) || "12:00";
            const prefecture = fd.get('prefecture' + prefix);
            const lat   = fd.get('lat' + prefix);
            const lon   = fd.get('lon' + prefix);
            const tz    = fd.get('tz' + prefix);
            const dst   = fd.get('dst' + prefix);

            const [hour, minute] = time.split(':');

            return new URLSearchParams({
            year, month, day,
            hour, minute,
            lat, lon,
            tz, dst,
            prefecture
            });
        }

        async function fetchHoroscopeAndDraw(prefix, containerId, canvasId) {
            const params = buildParamsFromForm(prefix);
            const url = "{% url 'horoscope_app:horoscope' %}";

            const response = await fetch(url, {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: params.toString()
            });

            if (!response.ok) {
            throw new Error("ホロスコープデータの取得に失敗しました");
            }
            const data = await response.json();

            const chartContainer = document.getElementById(containerId);
            chartContainer.style.display = 'block';
            drawHoroscopeWheel(data, containerId, canvasId);

            // 既存の保存関数があるなら呼び出し
            const form = document.getElementById('horoscope-form');
            if (typeof saveFormDataToCookies === 'function') {
            saveFormDataToCookies(new FormData(form));
            }
        }

        // POST で別ページへ遷移（Django CSRF 対応）
        function postRedirect(actionUrl, params) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = actionUrl;

            // CSRF
            const csrf = document.createElement('input');
            csrf.type = 'hidden';
            csrf.name = 'csrfmiddlewaretoken';
            csrf.value = getCookie('csrftoken');
            form.appendChild(csrf);

            // params（URLSearchParams）を hidden にして追加
            for (const [k, v] of params.entries()) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = k;
            input.value = v;
            form.appendChild(input);
            }

            document.body.appendChild(form);
            form.submit();
        }
        </script>
        <!-- (A) 時刻不明チェックボックスの自動処理 -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const timeInput = document.getElementById('time1');
                const unknownCheckbox = document.getElementById('unknown1');
            
                unknownCheckbox.addEventListener('change', function () {
                    if (this.checked) {
                        timeInput.value = '';
                    } else {
                        // timeInput.value = '';
                    }
                });
            });
            document.addEventListener('DOMContentLoaded', function () {
                const timeInput = document.getElementById('time2');
                const unknownCheckbox = document.getElementById('unknown2');
            
                unknownCheckbox.addEventListener('change', function () {
                    if (this.checked) {
                        timeInput.value = '';
                    } else {
                        // timeInput.value = '';
                    }
                });
            });
        </script>

        <!-- (C) クッキー周りのヘルパー関数 (必要な場合) -->
        <script>
            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + (days*24*60*60*1000));
                const expires = "expires="+ d.toUTCString();
                document.cookie = `${name}=${value};${expires};path=/`;
            }
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>

        <!-- (D) フォームの入力値をクッキーに保存＆復元 (必要に応じて) -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const yearSelect = document.getElementById('year-select1');
                const monthSelect = document.getElementById('month-select1');
                const daySelect = document.getElementById('day-select1');
                const timeInput = document.querySelector('input[name="time1"]');
                const prefectureSelect = document.getElementById('prefecture1');
                const checkboxSelect = document.getElementById('unknown1');

                // クッキーから読み込む例 (省略可)
                const savedYear = getCookie('horoscope_year1');
                const savedMonth = getCookie('horoscope_month1');
                const savedDay = getCookie('horoscope_day1');
                const savedTime = getCookie('horoscope_time1');
                const savedPrefecture = getCookie('horoscope_prefecture1');
                const savedCheckbox = getCookie('horoscope_checkbox1');

                if (yearSelect && savedYear) {
                    yearSelect.value = savedYear;
                }
                if (monthSelect && savedMonth) {
                    monthSelect.value = savedMonth;
                }
                if (daySelect && savedDay) {
                    daySelect.value = savedDay;
                }
                if (timeInput && savedTime !== null) {
                    timeInput.value = savedTime;
                }
                if (checkboxSelect && savedCheckbox !== null) {
                    checkboxSelect.checked = (savedCheckbox === 'true');
                }
                if (prefectureSelect && savedPrefecture) {
                    const options = prefectureSelect.options;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i].value === savedPrefecture) {
                            prefectureSelect.selectedIndex = i;
                            break;
                        }
                    }
                }

                // デフォルト値の設定（Cookieに該当値がない場合のみ）
                if (!savedYear || !savedMonth || !savedDay) {
                    const now = new Date();
                    if (yearSelect && !savedYear)  yearSelect.value  = now.getFullYear();
                    if (monthSelect && !savedMonth) monthSelect.value = String(now.getMonth() + 1);
                    if (daySelect && !savedDay)     daySelect.value   = String(now.getDate());
                }
                if (!savedTime && savedCheckbox == null) {
                    const now = new Date();
                    const hours   = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    if (timeInput) timeInput.value = `${hours}:${minutes}`;
                }
                // 都道府県切り替え
                if (prefectureSelect) {
                    function updateLatLon(e) {
                        const selected = e.target.selectedOptions[0];
                        document.getElementById('lat1').value = selected.getAttribute('data-lat');
                        document.getElementById('lon1').value = selected.getAttribute('data-lon');
                    }
                    // 初期化
                    const defaultSelected = prefectureSelect.selectedOptions[0];
                    document.getElementById('lat1').value = defaultSelected.getAttribute('data-lat');
                    document.getElementById('lon1').value = defaultSelected.getAttribute('data-lon');
                    // 変更イベント
                    prefectureSelect.addEventListener('change', updateLatLon);
                }
            });
            document.addEventListener('DOMContentLoaded', () => {
                const yearSelect = document.getElementById('year-select2');
                const monthSelect = document.getElementById('month-select2');
                const daySelect = document.getElementById('day-select2');
                const timeInput = document.querySelector('input[name="time2"]');
                const prefectureSelect = document.getElementById('prefecture2');
                const checkboxSelect = document.getElementById('unknown2');

                // クッキーから読み込む例 (省略可)
                const savedYear = getCookie('horoscope_year2');
                const savedMonth = getCookie('horoscope_month2');
                const savedDay = getCookie('horoscope_day2');
                const savedTime = getCookie('horoscope_time2');
                const savedPrefecture = getCookie('horoscope_prefecture2');
                const savedCheckbox = getCookie('horoscope_checkbox2');

                if (yearSelect && savedYear) {
                    yearSelect.value = savedYear;
                }
                if (monthSelect && savedMonth) {
                    monthSelect.value = savedMonth;
                }
                if (daySelect && savedDay) {
                    daySelect.value = savedDay;
                }
                if (timeInput && savedTime !== null) {
                    timeInput.value = savedTime;
                }
                if (checkboxSelect && savedCheckbox !== null) {
                    checkboxSelect.checked = (savedCheckbox === 'true');
                }
                if (prefectureSelect && savedPrefecture) {
                    const options = prefectureSelect.options;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i].value === savedPrefecture) {
                            prefectureSelect.selectedIndex = i;
                            break;
                        }
                    }
                }

                // デフォルト値の設定（Cookieに該当値がない場合のみ）
                if (!savedYear || !savedMonth || !savedDay) {
                    const now = new Date();
                    if (yearSelect && !savedYear)  yearSelect.value  = now.getFullYear();
                    if (monthSelect && !savedMonth) monthSelect.value = String(now.getMonth() + 1);
                    if (daySelect && !savedDay)     daySelect.value   = String(now.getDate());
                }
                if (!savedTime && savedCheckbox == null) {
                    const now = new Date();
                    const hours   = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    if (timeInput) timeInput.value = `${hours}:${minutes}`;
                }
                // 都道府県切り替え
                if (prefectureSelect) {
                    function updateLatLon(e) {
                        const selected = e.target.selectedOptions[0];
                        document.getElementById('lat2').value = selected.getAttribute('data-lat');
                        document.getElementById('lon2').value = selected.getAttribute('data-lon');
                    }
                    // 初期化
                    const defaultSelected = prefectureSelect.selectedOptions[0];
                    document.getElementById('lat2').value = defaultSelected.getAttribute('data-lat');
                    document.getElementById('lon2').value = defaultSelected.getAttribute('data-lon');
                    // 変更イベント
                    prefectureSelect.addEventListener('change', updateLatLon);
                }
            });
        </script>
        
        <!-- (E) フォーム送信（ボタンクリック）本番運用 -->
        <script>
            
            // Django等でCSRFトークンがセットされている想定
            const csrftoken = getCookie('csrftoken');
            
            // 送信ボタンの要素（例: 3つのボタン）
            const submitButtons = [
            document.getElementById('submit-button7'),
            document.getElementById('submit-button8'),
            document.getElementById('submit-button17'),
            document.getElementById('submit-button18')
            ];
            const resultDiv = document.getElementById('result');

            // フォームデータをオブジェクトに変換するヘルパー関数
            const formDataToObject = formData => {
                const data = {};
                formData.forEach((value, key) => data[key] = value);
                return data;
            };
            
            // クッキーに保存する関数
            function saveFormDataToCookies(formData) {
                const data = formDataToObject(formData);
                setCookie('horoscope_year1', data.year1, 30); // 30日間有効
                setCookie('horoscope_month1', data.month1, 30); // 30日間有効
                setCookie('horoscope_day1', data.day1, 30); // 30日間有効
                setCookie('horoscope_time1', data.time1, 30);
                setCookie('horoscope_prefecture1', data.prefecture1, 30);
                
                // チェックボックスの状態を 'true' または 'false' で保存
                const isChecked1 = formData.has('unknown1') ? 'true' : 'false';
                setCookie('horoscope_checkbox1', isChecked1, 30);


                setCookie('horoscope_year2', data.year2, 30); // 30日間有効
                setCookie('horoscope_month2', data.month2, 30); // 30日間有効
                setCookie('horoscope_day2', data.day2, 30); // 30日間有効
                setCookie('horoscope_time2', data.time2, 30);
                setCookie('horoscope_prefecture2', data.prefecture2, 30);
                
                // チェックボックスの状態を 'true' または 'false' で保存
                const isChecked2 = formData.has('unknown2') ? 'true' : 'false';
                setCookie('horoscope_checkbox2', isChecked2, 30);
            }
            
            // 送信ハンドラー生成関数
            const createSubmitHandler = (sbValue, spinnerId) => async e => {
                e.preventDefault();
                
                const form = e.target.form;
                if (!form) return;

                try {
                    // フォームデータ処理
                    const formData = new FormData(form);
                    const data = formDataToObject(formData);
                    
                    // 日付と時刻の分解
                    const year1 = data.year1;
                    const month1 = data.month1;
                    const day1 = data.day1;
                    const time1  = data.time1 || "12:00";
                    const [hour1, minute1] = time1.split(':');
                    const unknown1 = data.unknown1;
                    const prefecture1 = data.prefecture1;
                    
                    const year2 = data.year2;
                    const month2 = data.month2;
                    const day2 = data.day2;
                    const time2  = data.time2 || "12:00";
                    const [hour2, minute2] = time2.split(':');
                    const unknown2 = data.unknown2;
                    const prefecture2 = data.prefecture2;

                    // 送信データの組み立て
                    const sendData = {
                        year1: year1,
                        month1: month1,
                        day1: day1,
                        hour1: hour1,
                        minute1: minute1,
                        lat1: data.lat1,
                        lon1: data.lon1,
                        tz1: data.tz1,
                        dst1: data.dst1,
                        unknown1: unknown1,
                        prefecture1: prefecture1,
                        year2: year2,
                        month2: month2,
                        day2: day2,
                        hour2: hour2,
                        minute2: minute2,
                        lat2: data.lat2,
                        lon2: data.lon2,
                        tz2: data.tz2,
                        dst2: data.dst2,
                        unknown2: unknown2,
                        prefecture2: prefecture2,
                        sb: sbValue
                    };

                    // UI状態更新
                    submitButtons.forEach(btn => btn.disabled = true);
                    const spinner = document.getElementById(spinnerId);
                    if (spinner) spinner.style.display = 'inline-block';

                    // APIリクエスト
                    const response = await fetch("{% url 'horoscope_app:analyze_compatibility' %}", {
                    method: 'POST',
                    credentials: 'same-origin',  // これを追加
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': csrftoken
                    },
                    body: new URLSearchParams(sendData)
                    });

                    // レスポンス処理
                    const content = await response.json();
                    if (!response.ok) throw new Error(content.error || 'Unknown error');

                    // Markdown処理とサニタイズ
                    const cleanHtml = DOMPurify.sanitize(marked.parse(content.result));
                    resultDiv.innerHTML = cleanHtml;

                    // クッキーに保存
                    saveFormDataToCookies(formData);

                } catch (error) {
                    const errorMessage = error.name === 'SyntaxError' 
                    ? 'Invalid server response'
                    : error.message;
                    resultDiv.textContent = error.response ?
                     `エラー: ${error.message}` 
                    : `通信エラー: ${errorMessage}`;
                } finally {
                    submitButtons.forEach(btn => btn.disabled = false);
                    const spinner = document.getElementById(spinnerId);
                    if (spinner) spinner.style.display = 'none';
                }
            };

            // ボタン設定とイベントリスナーの登録
            const buttonConfigs = [
            { id: 'submit-button7', spinner: 'spinner7', sb: 7 },
            { id: 'submit-button8', spinner: 'spinner8', sb: 8 },
            { id: 'submit-button17', spinner: 'spinner17', sb: 17 },
            { id: 'submit-button18', spinner: 'spinner18', sb: 18 }
            ];

            buttonConfigs.forEach(({ id, spinner, sb }) => {
            const button = document.getElementById(id);
            if (button) {
                button.addEventListener('click', createSubmitHandler(sb, spinner));
            }
            });
        </script>

        <!-- (F) ホロスコープを生成・描画するスクリプト -->
        <script>
            // 惑星英名 => 惑星和名
            const planetNameMap = {
                "Sun"     : "太陽",
                "Moon"    : "月",
                "Mercury" : "水星",
                "Venus"   : "金星",
                "Mars"    : "火星",
                "Jupiter" : "木星",
                "Saturn"  : "土星",
                "Uranus"  : "天王星",
                "Neptune" : "海王星",
                "Pluto"   : "冥王星"
            };
            // 惑星英名 => シンボル
            const planetSymbolMap = {
                "Sun"     : "☉",
                "Moon"    : "☾",
                "Mercury" : "☿",
                "Venus"   : "♀",
                "Mars"    : "♂",
                "Jupiter" : "♃",
                "Saturn"  : "♄",
                "Uranus"  : "♅",
                "Neptune" : "♆",
                "Pluto"   : "♇"
            };
            // アスペクト色（高級感のある金・銀・深紅・濃緑・ダークゴールド）
            const aspectColorMap = {
                "コンジャンクション": "#FFD700",  // 明るいゴールド（ゴールド）
                "オポジション": "#0000FF",        // ブルー（青）
                "スクエア": "#FF6347",            // 明るいレッド（トマトレッド）
                "トライン": "#32CD32",            // 明るいグリーン（ライムグリーン）
                "セクスタイル": "#FFCC33",        // 明るいゴールデンロッド（ライトゴールデンロッド）
                "Conjunction": "#FFD700",
                "Opposition": "#0000FF",
                "Square": "#FF6347",
                "Trine": "#32CD32",
                "Sextile": "#FFCC33"
            };
            // 星座のシンボル
            const zodiacSymbols = {
                0: "♈", 1: "♉", 2: "♊", 3: "♋",
                4: "♌", 5: "♍", 6: "♎", 7: "♏",
                8: "♐", 9: "♑", 10: "♒", 11: "♓"
            };

            /**
             * ホロスコープを描画する関数
             * @param {Object} horoscopeData サーバー等から取得したホロスコープ情報
             */
            function drawHoroscopeWheel(horoscopeData, name1, name2) {
                const chartContainer = document.getElementById(name1);
                const canvas = document.getElementById(name2);

                // canvas のサイズ調整
                let containerWidth = chartContainer.offsetWidth; 
                if (containerWidth > 300) {
                    containerWidth = 300; 
                }
                canvas.width = containerWidth;
                canvas.height = containerWidth;
                chartContainer.style.width  = containerWidth + "px";
                chartContainer.style.height = containerWidth + "px";

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius  = canvas.width * 0.4;

                // ハウスデータの処理（rotationOffset 等）
                const houseData = horoscopeData?.raw_data?.houses;
                let rotationOffset = 0;
                if (houseData && houseData.cusp && houseData.cusp.length > 0) {
                    const firstCuspDeg = houseData.cusp[0];
                    rotationOffset = (90 - firstCuspDeg) % 360;
                }
                function degToRad(deg) {
                    return (360 - (deg + rotationOffset) - 90) * Math.PI / 180;
                }

                // 背景グラデーション（中心から薄い青がかかるグラデーション）
                const bgGradient = ctx.createRadialGradient(
                    centerX, centerY, 0,
                    centerX, centerY, radius * 1.5
                );
                bgGradient.addColorStop(0,   "#f0f8ff");
                bgGradient.addColorStop(0.7, "#cceeff");
                bgGradient.addColorStop(1,   "#99bbff");
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 外円描画（ゴールドの外枠）
                ctx.save();
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius + 10, 0, 2 * Math.PI);
                ctx.shadowColor = 'rgba(30, 144, 255, 0.5)'; // 濃い青色のシャドウ
                ctx.shadowBlur = 10;
                ctx.strokeStyle = '#E0FFFF'; // プラチナシルバー
                ctx.lineWidth = 4;
                ctx.stroke();
                ctx.restore();

                // ハウス線とハウス番号（ハウス番号の色を黒に変更）
                if (houseData && houseData.cusp) {
                    for (let i = 0; i < houseData.cusp.length; i++) {
                        const cuspAngleDeg = houseData.cusp[i];
                        const angleRad = degToRad(cuspAngleDeg);

                        const x2 = centerX + (radius + 10) * Math.cos(angleRad);
                        const y2 = centerY + (radius + 10) * Math.sin(angleRad);

                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.lineTo(x2, y2);
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)'; // 黒
                        ctx.lineWidth = 1;
                        ctx.setLineDash([6, 4]); // 点線
                        ctx.stroke();
                        ctx.restore();

                        // ハウス番号を白で描画
                        const labelRadius = radius * 0.5;
                        const labelX = centerX + labelRadius * Math.cos(angleRad - 0.26);
                        const labelY = centerY + labelRadius * Math.sin(angleRad - 0.26);

                        ctx.save();
                        ctx.font = Math.floor(canvas.width * 0.025) + "px 'Times New Roman'";
                        ctx.fillStyle = "#000000"; // 黒
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText((i + 1).toString(), labelX, labelY);
                        ctx.restore();
                    }
                }

                // ★ 惑星配置
                const planets = horoscopeData?.raw_data?.planets;
                if (!planets) {
                    alert("惑星データが見つかりません。");
                    return;
                }
                const planetPositions = {};
                // drawnSymbols 配列は adjust 関数用（シンボル位置の調整用）
                const drawnSymbols = [];
                // planetSymbolsToDraw 配列にシンボル描画情報を保存し、後で最前面に描画する
                const planetSymbolsToDraw = [];

                /**
                 * adjust 関数
                 * 惑星シンボル同士が重なっている場合、元の位置から offset ずらした位置を返し、
                 * その位置と元の位置を線分で結びます。
                 *
                 * @param {CanvasRenderingContext2D} ctx - canvas のコンテキスト
                 * @param {number} x - 元の x 座標
                 * @param {number} y - 元の y 座標
                 * @param {number} angle - 惑星配置の角度 (ラジアン)
                 * @param {Array} drawnSymbols - 既に描画済みのシンボルの位置リスト
                 * @returns {Object} 調整後の {x, y} 座標
                 */
                function adjust(ctx, x, y, angle, drawnSymbols) {
                    const offsetStep = 30;         // 30px ずつずらす
                    let offset = 0;
                    let newX = x;
                    let newY = y;
                    const collisionThreshold = 15; // 中心間距離が15px未満なら重なっていると判定

                    while (true) {
                        let collision = false;
                        for (let pos of drawnSymbols) {
                            const dx = pos.x - newX;
                            const dy = pos.y - newY;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            if (distance < collisionThreshold) {
                                collision = true;
                                break;
                            }
                        }
                        if (!collision) {
                            break;
                        }
                        offset += offsetStep;
                        newX = x - offset * Math.cos(angle);
                        newY = y - offset * Math.sin(angle);
                        // 無限ループ防止のための上限
                        if (offset > 100) break;
                    }

                    // ずらしが発生していた場合、元の位置と調整後の位置を線分で結ぶ
                    if (offset > 0) {
                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(newX, newY);
                        ctx.strokeStyle = "rgba(255,255,255,0.5)";
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                        ctx.restore();
                    }
                    drawnSymbols.push({ x: newX, y: newY });
                    return { x: newX, y: newY };
                }

                // 各惑星の描画（惑星の円はそのまま描く）
                for (const planetName of Object.keys(planets)) {
                    const planetObj = planets[planetName];
                    if (planetObj.longitude === undefined) continue;
                    
                    let lonDeg = Array.isArray(planetObj.longitude)
                        ? planetObj.longitude[0]
                        : parseFloat(planetObj.longitude);
                    if (isNaN(lonDeg)) continue;
                    
                    const angleRad = degToRad(lonDeg);
                    const x = centerX + radius * Math.cos(angleRad);
                    const y = centerY + radius * Math.sin(angleRad);

                    // 惑星の円を描画（高級感のある色合い）
                    ctx.save();
                    ctx.beginPath();
                    ctx.arc(x, y, canvas.width * 0.008, 0, 2 * Math.PI);
                    let fillColor = '#dd3333';
                    switch (planetName) {
                        case 'Sun'     : fillColor = '#D4AF37'; break;  // ゴールド
                        case 'Moon'    : fillColor = '#C0C0C0'; break;  // シルバー
                        case 'Mercury' : fillColor = '#708090'; break;  // スレートグレー
                        case 'Venus'   : fillColor = '#B87333'; break;  // カッパー
                        case 'Mars'    : fillColor = '#8B0000'; break;  // ダークレッド
                        case 'Jupiter' : fillColor = '#CD7F32'; break;  // ブロンズ
                        case 'Saturn'  : fillColor = '#A67B5B'; break;  // ブロンズ系
                        case 'Uranus'  : fillColor = '#008080'; break;  // ティール
                        case 'Neptune' : fillColor = '#00008B'; break;  // ネイビー
                        case 'Pluto'   : fillColor = '#800080'; break;  // パープル
                    }
                    ctx.fillStyle = fillColor;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)'; // 黒色のシャドウ
                    ctx.shadowBlur = 6;
                    ctx.fill();
                    ctx.restore();

                    // adjust 関数でシンボルの位置を調整（重なりがあれば線分も描画）
                    const symbol = planetSymbolMap[planetName] || planetName;
                    const adjustedPos = adjust(ctx, x, y, angleRad, drawnSymbols);
                    // ※ 惑星シンボルは黒で描画（fillStyle を "#000000" に変更）
                    planetSymbolsToDraw.push({
                        symbol: symbol,
                        x: adjustedPos.x,
                        y: adjustedPos.y,
                        font: Math.floor(canvas.width * 0.08) + "px sans-serif",
                        fillStyle: "#000000" // 黒
                    });

                    planetPositions[planetName] = { x, y };
                }
                // ノード情報を取得
                const nodes = horoscopeData?.raw_data?.nodes;
                if (nodes && nodes["True Node"] && Array.isArray(nodes["True Node"].longitude)) {
                    const rawNodeLon = nodes["True Node"].longitude[0];
                    const nodeLon    = parseFloat(rawNodeLon);
                    if (!isNaN(nodeLon)) {
                        // ドラゴンヘッド（North Node）
                        const headDeg = nodeLon % 360;
                        // ドラゴンテイル（South Node）
                        const tailDeg = (headDeg + 180) % 360;

                        // 共通の描画関数
                        function drawNode(deg, symbol, fillColor) {
                            const angleRad = degToRad(deg);
                            const x = centerX + radius * Math.cos(angleRad);
                            const y = centerY + radius * Math.sin(angleRad);

                            // 円を描く
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(x, y, canvas.width * 0.008, 0, 2 * Math.PI);
                            ctx.fillStyle = fillColor;
                            ctx.shadowColor = 'rgba(0,0,0,0.3)';
                            ctx.shadowBlur = 6;
                            ctx.fill();
                            ctx.restore();

                            // シンボルを adjust して描画
                            const adjusted = adjust(ctx, x, y, angleRad, drawnSymbols);
                            planetSymbolsToDraw.push({
                                symbol: symbol,
                                x: adjusted.x,
                                y: adjusted.y,
                                font: Math.floor(canvas.width * 0.08) + "px sans-serif",
                                fillStyle: "#000000"
                            });

                            // 位置を planetPositions にも保存してアスペクト線で使う
                            planetPositions[symbol] = { x, y };
                        }

                        // ドラゴンヘッド：シンボル ☊、色を紫（例）に
                        drawNode(headDeg, "☊", "#800080");
                        // ドラゴンテイル：シンボル ☋、色を濃緑（例）に
                        drawNode(tailDeg, "☋", "#008000");
                    }
                }


                // アスペクト描画
                const aspects = horoscopeData?.analysis?.["4.アスペクトの結果"] || [];
                aspects.forEach(aspect => {
                    const planet1Ja = aspect.planet1;
                    const planet2Ja = aspect.planet2;
                    const aspectName = aspect.aspect;
                    let p1En = null, p2En = null;
                    for (const [en, ja] of Object.entries(planetNameMap)) {
                        if (ja === planet1Ja) p1En = en;
                        if (ja === planet2Ja) p2En = en;
                    }
                    if (!p1En || !p2En) return;

                    const pos1 = planetPositions[p1En];
                    const pos2 = planetPositions[p2En];
                    // ② フォールバックでノードを symbol キーにマッピング
                    if (!p1En) {
                        if (planet1Ja === "ドラゴンヘッド")  p1En = "☊";
                        if (planet1Ja === "ドラゴンテイル") p1En = "☋";
                    }
                    if (!p2En) {
                        if (planet2Ja === "ドラゴンヘッド")  p2En = "☊";
                        if (planet2Ja === "ドラゴンテイル") p2En = "☋";
                    }
                    if (!pos1 || !pos2) return;

                    let lineColor = aspectColorMap[aspectName] || "#AAAAAA"; // パステル調の色

                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(pos1.x, pos1.y);
                    ctx.lineTo(pos2.x, pos2.y);
                    ctx.strokeStyle = lineColor;
                    ctx.lineWidth = canvas.width * 0.002;
                    if (aspectName === "スクエア" || aspectName === "Square") {
                        ctx.setLineDash([5, 3]);
                    }
                    ctx.stroke();
                    ctx.restore();
                });

                const zodiacColors = [
                    "#FF0000", // Red (牡羊座)
                    "#808000", // Dark Yellow (牡牛座)　
                    "#008000", // Green (双子座)
                    "#0000FF", // Blue (蟹座)
                    "#FF0000", // Red (獅子座)
                    "#808000", // Dark Yellow (乙女座)　
                    "#008000", // Green (天秤座)
                    "#0000FF", // Blue (蠍座)
                    "#FF0000", // Red (射手座)
                    "#808000", // Dark Yellow (山羊座)　
                    "#008000", // Green (水瓶座)
                    "#0000FF", // Blue (魚座)
                ];

                // ★ 星座の区分線およびシンボルの描画（修正版）
                ctx.save();
                // 内側のホロスコープ円（radius）はそのまま利用
                // 内側の区分線の開始位置（ホロスコープ円から少し外側）
                const innerDividingRadius = radius + (canvas.width * 0.017);
                // 星座シンボルを描く半径（内側と外側の中間あたり）
                const zodiacSymbolRadius = radius + (canvas.width * 0.06);
                // 外側に描く大きな円の半径（星座シンボルの外側＋余白）
                const outerCircleRadius = zodiacSymbolRadius + (canvas.width * 0.03);
                
                for (let i = 0; i < 12; i++) {
                    // degToRad が反転しているので、開始角度と終了角度を入れ替えています
                    const startAngle = degToRad((i + 1) * 30);
                    const endAngle   = degToRad(i * 30);

                    ctx.beginPath();
                    // 外側円弧の開始点に移動
                    ctx.moveTo(
                        centerX + outerCircleRadius * Math.cos(startAngle),
                        centerY + outerCircleRadius * Math.sin(startAngle)
                    );
                    // 外側の円弧を描く（startAngle ～ endAngle）
                    ctx.arc(centerX, centerY, outerCircleRadius, startAngle, endAngle, false);
                    // 外側の円弧の終点と内側の円弧の開始点を直接結ぶ
                    ctx.lineTo(
                        centerX + innerDividingRadius * Math.cos(endAngle),
                        centerY + innerDividingRadius * Math.sin(endAngle)
                    );
                    // 内側の円弧を描く（endAngle ～ startAngle を逆方向に）
                    ctx.arc(centerX, centerY, innerDividingRadius, endAngle, startAngle, true);
                    // パスを閉じる（自動的に内側の円弧の終点と外側の円弧の開始点を結ぶ）
                    ctx.closePath();

                    // ctx.fillStyle = zodiacColors[i];
                    ctx.fill();
                }

                // ① 外側の大円の外周を描画（ゴールドのライン）
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerCircleRadius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#D4AF37';
                ctx.lineWidth = 4;
                ctx.stroke();

                // ② 星座区分線と星座シンボルの描画
                for (let i = 0; i < 12; i++) {
                    // 各星座の境界線の角度（0～360°）
                    const lineAngle = degToRad(i * 30);
                    // 区分線は内側（innerDividingRadius）から外側の大円（outerCircleRadius）まで
                    ctx.beginPath();
                    ctx.moveTo(
                        centerX + innerDividingRadius * Math.cos(lineAngle),
                        centerY + innerDividingRadius * Math.sin(lineAngle)
                    );
                    ctx.lineTo(
                        centerX + outerCircleRadius * Math.cos(lineAngle),
                        centerY + outerCircleRadius * Math.sin(lineAngle)
                    );
                    ctx.strokeStyle = "rgba(50, 50, 50, 0.8)"; // 濃いグレー
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    // 星座シンボルは区分線の中央あたりに配置（色を黒に変更）
                    const midAngleRad = degToRad(i * 30 + 15);
                    // シンボルを配置する半径は内側と外側の中間
                    const symbolRadius = (innerDividingRadius + outerCircleRadius) / 2;
                    const textX = centerX + symbolRadius * Math.cos(midAngleRad);
                    const textY = centerY + symbolRadius * Math.sin(midAngleRad);

                    ctx.save();
                    ctx.translate(textX, textY);
                    ctx.font = Math.floor(canvas.width * 0.05) + "px 'Segoe UI Symbol', 'Arial', sans-serif"; 
                    ctx.fillStyle = "#000000";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(zodiacSymbols[i], 0, 0);
                    ctx.restore();
                }
                ctx.restore();

                // ★ 最後に、保存しておいた惑星シンボルを再描画して最前面に表示（色を黒に変更）
                planetSymbolsToDraw.forEach(item => {
                    ctx.save();
                    ctx.font = item.font;
                    ctx.fillStyle = item.fillStyle;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(item.symbol, item.x, item.y);
                    ctx.restore();
                });
            }
        </script>


        <script>

        // prefix = "1" or "2"（フォームから送信用パラメータを作る）
        function buildParamsFromForm(prefix) {
            const form = document.getElementById('horoscope-form');
            const fd = new FormData(form);

            const year  = fd.get('year' + prefix);
            const month = fd.get('month' + prefix);
            const day   = fd.get('day' + prefix);
            const time  = fd.get('time' + prefix) || '12:00';
            const prefecture = fd.get('prefecture' + prefix);
            const lat   = fd.get('lat' + prefix);
            const lon   = fd.get('lon' + prefix);
            const tz    = fd.get('tz' + prefix);
            const dst   = fd.get('dst' + prefix);

            const [hour, minute] = time.split(':');

            return new URLSearchParams({
            year, month, day,
            hour, minute,
            lat, lon,
            tz, dst,
            prefecture
            });
        }

        // POST で取得 → キャンバス描画 → Cookie 保存（必要なら）
        async function fetchHoroscopeAndDraw(prefix, containerId, canvasId, alsoSaveCookies = true) {
            const params = buildParamsFromForm(prefix);
            const url = "{% url 'horoscope_app:horoscope' %}";

            const response = await fetch(url, {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: params.toString()
            });

            if (!response.ok) {
            throw new Error('ホロスコープデータの取得に失敗しました');
            }

            const data = await response.json();

            const chartContainer = document.getElementById(containerId);
            chartContainer.style.display = 'block';
            // 既存の drawHoroscopeWheel(horoscopeData, containerId, canvasId) を使用
            drawHoroscopeWheel(data, containerId, canvasId);

            if (alsoSaveCookies && typeof saveFormDataToCookies === 'function') {
            const form = document.getElementById('horoscope-form');
            saveFormDataToCookies(new FormData(form));
            }
        }

        // ---------- イベント: ボタン（1人目） ----------
        const btn1 = document.getElementById('draw-button1');
        if (btn1) {
            btn1.addEventListener('click', async function () {
            try {
                await fetchHoroscopeAndDraw('1', 'chart-container1', 'horoscope-canvas1', true);
            } catch (e) {
                alert(e.message);
                console.error(e);
            }
            });
        }

        // ---------- イベント: 画面読み込み時（1人目） ----------
        document.addEventListener('DOMContentLoaded', async function () {
            try {
            await fetchHoroscopeAndDraw('1', 'chart-container1', 'horoscope-canvas1', true);
            } catch (e) {
            // 初回は静かに
            console.warn(e);
            }
        });

        // ---------- イベント: ボタン（2人目） ----------
        const btn2 = document.getElementById('draw-button2');
        if (btn2) {
            btn2.addEventListener('click', async function () {
            try {
                await fetchHoroscopeAndDraw('2', 'chart-container2', 'horoscope-canvas2', true);
            } catch (e) {
                alert(e.message);
                console.error(e);
            }
            });
        }

        // ---------- イベント: 画面読み込み時（2人目） ----------
        document.addEventListener('DOMContentLoaded', async function () {
            try {
            await fetchHoroscopeAndDraw('2', 'chart-container2', 'horoscope-canvas2', true);
            } catch (e) {
            console.warn(e);
            }
        });
        </script>
        <!-- 詳細画面へリンク -->
        <script>
            document.getElementById('view-button1').addEventListener('click', function() {
            const form = document.getElementById('horoscope-form');
            const formData = new FormData(form);
            const year  = formData.get('year1');
            const month = formData.get('month1');
            const day   = formData.get('day1');
            const time  = formData.get('time1') || "12:00";
            const prefecture = formData.get('prefecture1');
            const lat   = formData.get('lat1');
            const lon   = formData.get('lon1');
            const tz    = formData.get('tz1');
            const dst   = formData.get('dst1');
        
            const [hour, minute] = time.split(':');
        
            const params = new URLSearchParams({
                year, month, day,
                hour, minute,
                lat, lon,
                tz, dst,
                prefecture
            });
            
            saveFormDataToCookies(formData);

            const horoscopeUrl = "{% url 'horoscope_app:horoscope_detail' %}?" + params.toString();
            window.location.href = horoscopeUrl;
            });
            document.getElementById('view-button2').addEventListener('click', function() {
            const form = document.getElementById('horoscope-form');
            const formData = new FormData(form);
            const year  = formData.get('year2');
            const month = formData.get('month2');
            const day   = formData.get('day2');
            const time  = formData.get('time2') || "12:00";
            const prefecture = formData.get('prefecture2');
            const lat   = formData.get('lat2');
            const lon   = formData.get('lon2');
            const tz    = formData.get('tz2');
            const dst   = formData.get('dst2');
        
            const [hour, minute] = time.split(':');
        
            const params = new URLSearchParams({
                year, month, day,
                hour, minute,
                lat, lon,
                tz, dst,
                prefecture
            });
            
            saveFormDataToCookies(formData);

            const horoscopeUrl = "{% url 'horoscope_app:horoscope_detail' %}?" + params.toString();
            window.location.href = horoscopeUrl;
            });
        </script>
        <script>
            document.getElementById("copyBtn").addEventListener("click", function (event) {
                event.preventDefault(); // デフォルト動作を防ぐ（フォーム内などで有効）
                const text = document.getElementById("result").innerText;
                navigator.clipboard.writeText(text).then(() => {
                    alert("コピーしました！");
                }).catch(err => {
                    alert("コピーに失敗しました: " + err);
                });
            });
        </script>
    </body>
</html>
