{% load static %}
<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <!-- ★レスポンシブ対応の viewport 指定 -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- SEO用 meta タグ -->
        <meta name="description" content="AI占星術師アオポンによる無料ホロスコープ作成・占いサービス。生年月日、出生時刻、出生地からあなたのホロスコープを作成し、性格、恋愛運、仕事運、金運、健康運、学業運などを占います。">
        <meta name="keywords" content="ホロスコープ, ホロスコープ作成, 占星術, AI占星術, 性格, 恋愛運, 仕事運, 金運, 健康運, 学業運">
        <meta name="robots" content="index, follow">
        
        <!-- Canonical タグ（URLが確定している場合） -->
        <link rel="canonical" href="https://aihoroscopeanalysis.com/">

        <!-- OGPタグ（SNS等でのシェア用） -->
        <meta property="og:title" content="無料ホロスコープ作成・占い - AI占星術師アオポン">
        <meta property="og:description" content="生年月日、出生時刻、出生地からあなたのホロスコープを作成し、性格・恋愛運・仕事運・金運・健康運・学業運を占います。">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://aihoroscopeanalysis.com/">
        <meta property="og:image" content="{% static 'path/to/horoscope-demo6.png' %}">

        <!-- JSON-LDによる構造化データ -->
        <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "無料ホロスコープ作成・占い - AI占星術師アオポン",
        "description": "生年月日、出生時刻、出生地からあなたのホロスコープを無料で作成し、性格・恋愛運・仕事運・金運・健康運・学業運を占うAI占星術師アオポンのサービスです。",
        "url": "https://aihoroscopeanalysis.com/"
        }
        </script>

        <title>無料ホロスコープ作成・占い - AI占星術師アオポン</title>
        
        <!-- Marked.jsのUMDビルドを読み込む -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <!-- DOMPurifyを読み込む（セキュリティ対策） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.10/purify.min.js"></script>
        
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QL89EXFC"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-V8QL89EXFC');
        </script>

        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "q3kqriyub6");
        </script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9717699132149345"
        crossorigin="anonymous"></script>
        
        <style>
            /* 全体リセット・ベース設定 */
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                /* 例：Google Fonts 等で 'Merriweather' や 'Playfair Display' を読み込んだ上で */
                font-family: 'Merriweather', serif;
                margin: 0;
                background: linear-gradient(135deg, #fdfbfb, #ebedee);
            }

            /* ヘッダー */
            h1 {
                background: linear-gradient(90deg, #2c3e50, #4ca1af);
                color: #fff;
                padding: 20px;
                text-align: center;
                margin: 0;
                width: 100%;
                font-family: 'Playfair Display', serif;  /* 上質な印象のセリフ体 */
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }

            /* メインコンテナー */
            .content-container {
                display: flex; 
                justify-content: space-between;
                gap: 20px;
                padding: 0px;
                /* 画面が狭いときは縦並びに */
                flex-wrap: wrap;
            }

            /* フォーム全体 */
            #horoscope-form {
                flex: 1;
                max-width: 100%;
                background-color: #fff;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
                border: 1px solid #e0e0e0;
            }

            /* テーブルのスタイル */
            #horoscope-form table {
                width: 100%;
                border-collapse: collapse;
            }
            #horoscope-form th, 
            #horoscope-form td {
                padding: 16px 20px;
                border: none;
                border-bottom: 1px solid #e0e0e0;
                text-align: left;
                vertical-align: middle;
            }
            #horoscope-form th {
                background-color: transparent;
                color: #333;
                font-weight: bold;
            }
            #horoscope-form td {
                background-color: #fff;
            }

            /* input, select */
            input, select {
                width: 100%;
                padding: 8px;
                margin-top: 5px;
                box-sizing: border-box;
            }
            input,select {
            /* 高さを小さく設定 */
            height: 30px;
            line-height: 30px;
            
            /* 内側の余白 */
            padding: 0 10px;
            
            /* フォントサイズ */
            font-size: 16px;
            
            /* 枠線・角丸 */
            border: 1px solid #ccc;
            border-radius: 5px;
            
            /* 背景色 */
            background-color: #fff;
            
            /* iOS等でのデフォルトのスタイル（矢印など）を解除 */
            /* appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none; */
            
            /* レンダリングのためにボックスサイズを指定 */
            box-sizing: border-box;
            }
            #horoscope-form input[type="time"] {
                width: auto; 
                min-width: 100px;
            }

            /* 共通ボタンスタイルの変更 */
            button {
                margin-top: 20px;
                padding: 12px 24px;
                cursor: pointer;
                border-radius: 8px;
                font-size: 16px;
                border: none;
                transition: all 0.3s ease;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            button:hover:not(:disabled) {
                filter: brightness(95%);
                transform: translateY(-2px);
            }

            /* 各ボタンのカラー例 */
            /* 性格 */
            #submit-button1 {
                background: linear-gradient(45deg, #8e44ad, #9b59b6);
            }
            /* 恋愛運 */
            #submit-button2 {
                background: linear-gradient(45deg, #e74c3c, #e67e22);
            }
            /* 仕事運 */
            #submit-button3 {
                background: linear-gradient(45deg, #27ae60, #2ecc71);
            }
            /* 金運 (テキストは暗色) */
            #submit-button4 {
                background: linear-gradient(45deg, #f1c40f, #f39c12);
            }
            /* 健康運 */
            #submit-button5 {
                background: linear-gradient(45deg, #16a085, #1abc9c);
            }
            /* 学業運 (テキストは暗色) */
            #submit-button6 {
                background: linear-gradient(45deg, #d35400, #e67e22);
            }
            /* 学業運 (テキストは暗色) */
            #submit-button9 {
                background: linear-gradient(45deg, #1ABC9C, #16A085);
            }
            /* 学業運 (テキストは暗色) */
            #submit-button10 {
                background: linear-gradient(45deg, #2980b9, #3498db);
            }

            /* スピナーのスタイル */
            .spinner {
                border: 4px solid rgba(0, 0, 0, 0.1);
                border-top: 4px solid #4CAF50; 
                border-radius: 50%;
                width: 24px;
                height: 24px;
                animation: spin 1s linear infinite;
                display: inline-block;
                vertical-align: middle;
                margin-left: 10px;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            /* 結果表示のスタイル */
            #result,
            .result-sample {
                margin-top: 30px;
                padding: 15px;
                border: 1px solid #ccc;
                background-color: #f9f9f9;
                white-space: pre-line;
                font-size: 16px;
                color: #333;
            }
            /* resultDiv 内のリストのスタイルを調整 */
            #result ol,
            #result ul,
            .result-sample ol,
            .result-sample ul {
                margin-left: 1.5em;  /* 必要に応じて数値を調整 */
                padding-left: 0;
            }
            .horoscope-meaning ul {
                margin-left: 1.5em;  /* 必要に応じて数値を調整 */
                padding-left: 0;
            }

            /* エラーメッセージのスタイル */
            #error-message {
                color: red;
                margin-top: 10px;
            }

            /* 小さい説明文 */
            small {
                display: block;
                margin-top: 5px;
                color: #666;
            }

            /* テーブル配置用のラッパ */
            #container-table {
                margin: auto;
                width: 100%;
                max-width: 1000px;
            }

            /**
            * ホロスコープ描画用のコンテナ
            * ここを JavaScript 側で width/height を同じに設定します。
            */
            #chart-container {
                position: relative; /* 惑星ラベルを absolute 配置するため */
                margin: 0 auto;
                /* margin-bottom: 10px; */
                /* CSS 側では width/height を固定しない: JS で動的にセット */
                border: 1px solid #ccc;
                display: none; /* 最初は非表示 */
            }

            /* canvas はJSで (最大1000 x 1000) にします */
            #horoscope-canvas {
                display: block; /* ブロック要素化 */
                width: 100%;    /* ここで #chart-container と同じ幅にフィット */
                height: 100%;   /* 同上 */
                background: #99bbff;
            }

            
            /* モーダル関連 */
            .modal {
                display: none;
                position: fixed; 
                z-index: 1000; 
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%; 
                overflow: auto; 
                background-color: rgba(0, 0, 0, 0.5); 
            }
            .modal-content {
                background-color: #fff;
                margin: 10% auto;
                padding: 5px;
                border: none;
                width: 80%;
                max-width: 700px;
                position: relative;
                border-radius: 12px;
                box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            }
            
            /* モーダル開閉ボタン */
            .open-modal-btn {
                background: linear-gradient(45deg, #2c3e50, #4ca1af); /* 高級感あるグラデーション */
                color: #fff;
                padding: 14px 28px;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, filter 0.3s ease;
            }

            .open-modal-btn:hover {
                filter: brightness(95%);
                transform: translateY(-2px);
            }

            /* インプットやチェックボックスを横並びにする簡易レイアウト */
            .input-group {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .checkbox-label {
                display: flex;
                white-space: nowrap;
                gap: 4px;
            }

            /* ★ レスポンシブ（画面幅が768px以下の場合） */
            @media (max-width: 768px) {
                h1 {
                    font-size: 1.2em;
                    padding: 15px;
                }
                .content-container {
                    flex-direction: column;
                    align-items: center;
                }
                #container-table {
                    width: 100%;
                    max-width: 100%;
                }
                #horoscope-form th, 
                #horoscope-form td {
                    padding: 8px;
                    font-size: 0.9em;
                }
                .modal-content {
                    margin: 30% auto 0;
                    width: 90%;
                }
            }
            /* 全体コンテナ */
            .horoscope-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 10px;
            }

            /* ホロスコープ作成ボタン */
            .horoscope-create {
            text-align: center;
            }

            /* コンテナのスタイル */
            .analysis-buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            /* 各ボタン共通のスタイル */
            .analysis-button button {
                padding: 10px 20px;
                font-size: 16px;
                border: none;
                border-radius: 5px;
                color: #fff;
                cursor: pointer;
                transition: background-color 0.3s ease, filter 0.3s ease;
            }
            .analysis-buttons {
            display: flex;
            justify-content: space-evenly; /* 均等にスペースを空ける */
            align-items: center; /* 垂直方向の中央揃え */
            }

            /* 各ボタンを同じ幅にしたい場合 */
            .analysis-button {
            flex: 1;                   /* 各要素の幅を均等に */
            display: flex;
            justify-content: center;   /* 内部のボタンを中央寄せ */
            }
            
            
            /* ホバー時：少し暗めに */
            .analysis-button button:hover:not(:disabled) {
                filter: brightness(90%);
            }
            
            /* disabled状態のスタイル */
            .analysis-button button:disabled {
                background-color: #ddd;
                color: #aaa;
                cursor: not-allowed;
            }
            

            /* 初期状態で非表示のスピナー */
            .spinner {
            display: none;
            }

            
            html, body {
            height: 100%;
            margin: 0;
            }
            @media (max-width: 768px) {
            .analysis-buttons {
                /* 2列レイアウトのため、横並びにして折り返しを許可 */
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between; /* ボタン間のスペースを調整 */
            }
            .analysis-button {
                /* 各ボタンの幅を2列分に（gap分を引いた値） */
                min-width: calc(50% - 10px);
                margin-bottom: 10px;
            }
            }
            /* ページ全体をラップするコンテナ */
            .wrapper {
            flex-direction: column;
            min-height: 100%;
            }
            /* コンテンツエリアは空いたスペースをすべて使う */
            .content {
            flex: 1;
            padding: 0px;
            }
            /* フッター（広告）のスタイル */
            .footer {
            background-color: #f9f9f9;
            text-align: center;
            padding: 10px 0;
            }
            /* 広告バナー全体のスタイル（中央寄せなど） */
            #ad-banner {
            text-align: center;
            margin: 20px auto;
            }
            /* デフォルトではデスクトップ広告を表示 */
            .desktop-ad {
            display: block;
            }
            .mobile-ad {
            display: none;
            }
            /* 画面幅が768px以下の場合はモバイル広告に切り替え */
            @media screen and (max-width: 768px) {
            .desktop-ad {
                display: none;
            }
            .mobile-ad {
                display: block;
            }
            }
            /* 3カラムレイアウト用のスタイル */
            .layout-wrapper {
            display: flex;
            justify-content: center; /* 中央寄せ */
            align-items: flex-start;
            gap: 20px; /* 広告と中央コンテンツの間の隙間 */
            max-width: 1600px; /* コンテンツ全体の最大幅 */
            margin: 0 auto;
            padding: 0px;
            }

            /* 広告エリアのスタイル */
            .side-ad {
            flex: 0 0 250px; /* 固定幅 160px（必要に応じて調整） */
            }

            /* 中央コンテンツエリア */
            .main-content {
            flex: 1;
            background-color: transparent;
            padding: 0px;
            /* border-radius: 12px; */
            /* box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); */
            /* border: 1px solid #e0e0e0; */
            }

            /* レスポンシブ対応：画面幅が768px以下の場合は広告を非表示に */
            @media (max-width: 768px) {
            .layout-wrapper {
                flex-direction: column;
                padding: 10px;
            }
            .side-ad {
                display:flexbox;
            }
            .main-content {
                width: 100%;
            }
            /* 左寄せのサイドバー用（必要に応じて調整） */
            .left-ad {
            float: left;
            width: 100%;                   /* 幅は調整可能 */
            }
            }
            /* サイドバー全体のスタイル */
            .side-ad {
            background-color: #f7f7f7;      /* やわらかい背景色 */
            border: 1px solid #ddd;         /* 薄い枠線 */
            padding: 15px;
            border-radius: 8px;             /* 角を丸く */
            margin: 10px;
            font-family: 'Arial', sans-serif;
            }

            /* 左寄せのサイドバー用（必要に応じて調整） */
            .left-ad {
            float: left;
            /* width: 250px; */
            }

            /* リスト全体のリセット */
            .ad-content ul {
            list-style: none;               /* デフォルトのマーカーを非表示 */
            margin: 0;
            padding: 0;
            }

            /* 各リストアイテムの間隔 */
            .ad-content ul li {
            margin-bottom: 10px;
            }

            /* リンクのスタイル */
            .ad-content ul li a {
            display: block;                 /* リンク全体をブロック要素に */
            text-decoration: none;          /* 下線なし */
            color: #333;
            font-weight: bold;
            padding: 8px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
            }

            /* リンクホバー時のスタイル */
            .ad-content ul li a:hover {
            background-color: #e9e9e9;
            color: #000;
            }

            img {
            max-width: 100%;
            height: auto;
            }
            .container {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            }
            .form-section {
            width: 40%;
            }
            .canvas-section {
            width: 60%;
            }
            /* 親要素にFlexboxレイアウトを適用 */
            .container {
            display: flex;
            align-items: flex-start; /* 上揃え */
            gap: 20px;
            padding: 20px;
            }
            
            /* 左側：フォーム部分 */
            .form-section {
            flex: 0 0 auto;
            }
            
            /* 右側：キャンバス部分 */
            .canvas-section {
            flex: 1;
            /* display: flex; */
            justify-content: center;
            align-items: center;
            }
            
            /* キャンバスは初期サイズを400pxとしつつ、親要素に合わせて縮小 */
            canvas {
            width: 386px;
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            }
            
            /* 画面幅が768px以下の場合は縦並びに変更 */
            @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .form-section,
            .canvas-section {
                width: 100%;
            }
            
            /* 必要に応じてフォーム部分の最大幅を指定 */
            .form-section {
                max-width: 400px;
            }
            }
            .new-badge {
                position: relative;
            }
            .new-badge::after {
                content: "new!";
                position: absolute;
                top: 0;
                right: -30px; /* 必要に応じて調整 */
                color: red;
                font-weight: bold;
                font-size: 0.9em;
            }
        </style>
    </head>
    
    <body>
        <div class="wrapper">
            <h1>無料ホロスコープ作成・占い - AI占星術師アオポン</h1>
            <div class="layout-wrapper">
                <aside class="side-ad left-ad">
                    <div class="ad-content">
                        <h3>メニュー</h3>
                        <ul>
                            <li><a href="#main">メイン</a></li>
                            <li><a href="{% url 'horoscope_app:compatibility' %}">二人の相性占い</a></li>
                            <li><a href="#howtouse">利用方法</a></li>
                            <li><a href="#horoscope-sample">ホロスコープのサンプル（大谷翔平さん）</a></li>
                            <li><a href="#analysis-sample1">AIによる分析結果のサンプル（大谷翔平さん）性格</a></li>
                            <li><a href="#analysis-sample2">AIによる分析結果のサンプル（大谷翔平さん）仕事運</a></li>
                            <li><a href="#horoscope-meaning">コラム ホロスコープという統計的知恵</a></li>
                        </ul>
                        <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3DGHQA+3QW4+5Z6WX" rel="nofollow">
                            <img border="0" width="234" height="60" alt="" src="https://www21.a8.net/svt/bgt?aid=250203147204&wid=003&eno=01&mid=s00000017482001004000&mc=1"></a>
                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3DGHQA+3QW4+5Z6WX" alt="">
                        <a href="https://px.a8.net/svt/ejp?a8mat=44YQRN+23M45E+2VYS+6NETT" rel="nofollow">
                            <img border="0" width="234" height="60" alt="" src="https://www22.a8.net/svt/bgt?aid=250204163127&wid=003&eno=01&mid=s00000013474001117000&mc=1"></a>
                            <img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=44YQRN+23M45E+2VYS+6NETT" alt="">
                        <h3>おすすめ書籍</h3>
                        <ul>
                            <li><a href="https://amzn.to/3WL4DBg">CD-ROM付き いちばんやさしい西洋占星術入門</a></li>
                            <li><a href="https://amzn.to/4guj9V3">五十六謀星もっちぃの西洋占星術講義</a></li>
                            <li><a href="https://amzn.to/3WO5wsV">基礎からわかる 西洋占星術の完全独習: 星々の導きで運命をたどる旅</a></li>
                        </ul>
                    </div>
                </aside>
                <!-- 中央メインコンテンツエリア -->
                <main class="main-content">
                    <!-- コンテンツエリア -->
                    <div class="content">
                        <div class="content-container">
                            
                            <div id="data" style="width: 100%;">
                                <a id="main"></a>
                                <form id="horoscope-form" method="POST" action="#">
                                    {% csrf_token %}
                                    <div class="container">
                                        <div class="form-section">
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <th>生年月日</th>
                                                        <td>
                                                            <select name="year" id="year-select">
                                                                {% for year in years %}
                                                                    <option value="{{ year }}">{{ year }}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <select name="month" id="month-select">
                                                                {% for month in months %}
                                                                    <option value="{{ month }}">{{ month }}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <select name="day" id="day-select">
                                                                {% for day in days %}
                                                                    <option value="{{ day }}">{{ day }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>出生時刻</th>
                                                        <td>
                                                            <div class="input-group">
                                                                <input type="time" id="time" name="time" required />
                                                                <label for="unknown" class="checkbox-label">
                                                                    <input type="checkbox" id="unknown" name="unknown" />
                                                                    <span style="display: inline;">時刻不明</span>
                                                                </label>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>出生地</th>
                                                        <td>
                                                            <select name="prefecture" id="prefecture">
                                                                <option value="Hokkaido" data-lat="43.06417" data-lon="141.34694">北海道</option>
                                                                <option value="Aomori" data-lat="40.82444" data-lon="140.74">青森県</option>
                                                                <option value="Iwate" data-lat="39.70361" data-lon="141.1525">岩手県</option>
                                                                <option value="Miyagi" data-lat="38.26889" data-lon="140.87194">宮城県</option>
                                                                <option value="Akita" data-lat="39.71861" data-lon="140.1025">秋田県</option>
                                                                <option value="Yamagata" data-lat="38.24056" data-lon="140.36333">山形県</option>
                                                                <option value="Fukushima" data-lat="37.75" data-lon="140.46778">福島県</option>
                                                                <option value="Ibaraki" data-lat="36.34139" data-lon="140.44667">茨城県</option>
                                                                <option value="Tochigi" data-lat="36.56583" data-lon="139.88361">栃木県</option>
                                                                <option value="Gunma" data-lat="36.39111" data-lon="139.06083">群馬県</option>
                                                                <option value="Saitama" data-lat="35.85694" data-lon="139.64889">埼玉県</option>
                                                                <option value="Tokyo" data-lat="35.6895" data-lon="139.6917" selected>東京都</option>
                                                                <option value="Chiba" data-lat="35.60506" data-lon="140.12333">千葉県</option>
                                                                <option value="Kanagawa" data-lat="35.44778" data-lon="139.6425">神奈川県</option>
                                                                <option value="Niigata" data-lat="37.90222" data-lon="139.02361">新潟県</option>
                                                                <option value="Toyama" data-lat="36.69529" data-lon="137.21134">富山県</option>
                                                                <option value="Ishikawa" data-lat="36.59444" data-lon="136.62556">石川県</option>
                                                                <option value="Fukui" data-lat="36.06528" data-lon="136.22194">福井県</option>
                                                                <option value="Yamanashi" data-lat="35.66389" data-lon="138.56833">山梨県</option>
                                                                <option value="Nagano" data-lat="36.65139" data-lon="138.18111">長野県</option>
                                                                <option value="Gifu" data-lat="35.39111" data-lon="136.72222">岐阜県</option>
                                                                <option value="Shizuoka" data-lat="34.97694" data-lon="138.38306">静岡県</option>
                                                                <option value="Aichi" data-lat="35.18028" data-lon="136.90667">愛知県</option>
                                                                <option value="Mie" data-lat="34.73028" data-lon="136.50859">三重県</option>
                                                                <option value="Shiga" data-lat="35.00444" data-lon="135.86833">滋賀県</option>
                                                                <option value="Kyoto" data-lat="35.02139" data-lon="135.75556">京都府</option>
                                                                <option value="Osaka" data-lat="34.68639" data-lon="135.52">大阪府</option>
                                                                <option value="Hyogo" data-lat="34.69139" data-lon="135.18306">兵庫県</option>
                                                                <option value="Nara" data-lat="34.68528" data-lon="135.83278">奈良県</option>
                                                                <option value="Wakayama" data-lat="34.22611" data-lon="135.1675">和歌山県</option>
                                                                <option value="Tottori" data-lat="35.50361" data-lon="134.23833">鳥取県</option>
                                                                <option value="Shimane" data-lat="35.47222" data-lon="133.05056">島根県</option>
                                                                <option value="Okayama" data-lat="34.66167" data-lon="133.935">岡山県</option>
                                                                <option value="Hiroshima" data-lat="34.39639" data-lon="132.45962">広島県</option>
                                                                <option value="Yamaguchi" data-lat="34.18583" data-lon="131.47139">山口県</option>
                                                                <option value="Tokushima" data-lat="34.06583" data-lon="134.55944">徳島県</option>
                                                                <option value="Kagawa" data-lat="34.34028" data-lon="134.04333">香川県</option>
                                                                <option value="Ehime" data-lat="33.84167" data-lon="132.76556">愛媛県</option>
                                                                <option value="Kochi" data-lat="33.55972" data-lon="133.53108">高知県</option>
                                                                <option value="Fukuoka" data-lat="33.60639" data-lon="130.41806">福岡県</option>
                                                                <option value="Saga" data-lat="33.24944" data-lon="130.29889">佐賀県</option>
                                                                <option value="Nagasaki" data-lat="32.74472" data-lon="129.87361">長崎県</option>
                                                                <option value="Kumamoto" data-lat="32.78972" data-lon="130.74167">熊本県</option>
                                                                <option value="Oita" data-lat="33.23806" data-lon="131.6125">大分県</option>
                                                                <option value="Miyazaki" data-lat="31.91111" data-lon="131.42389">宮崎県</option>
                                                                <option value="Kagoshima" data-lat="31.56028" data-lon="130.55806">鹿児島県</option>
                                                                <option value="Okinawa" data-lat="26.2125" data-lon="127.68111">沖縄県</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="canvas-section">
                                            <div id="chart-container">
                                                <canvas id="horoscope-canvas"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 緯度/経度 (自動セット) -->
                                    <input type="hidden" step="0.0001" name="lat" id="lat" required readonly>
                                    <input type="hidden" step="0.0001" name="lon" id="lon" required readonly>
                                    <input type="hidden" step="0.1" name="tz" required value="9.0">
                                    <input type="hidden" step="0.1" name="dst" required value="0.0">
                            
                                    <div id="error-message"></div>
                                    
                                    <div class="horoscope-container">
                                        <!-- ホロスコープ作成ボタン -->
                                        <div class="horoscope-create">
                                            <!-- <button type="button" id="draw-button" class="open-modal-btn">ホロスコープを作成</button> -->
                                            <button type="button" id="view-button" class="open-modal-btn">ホロスコープの詳細</button>
                                            <button type="button" id="ai-button" class="">ホロスコープの詳細（AI用）</button>
                                        </div>
                                        <div style="text-align: right;">
                                            <span style="font-size: x-small;">（プラシーダス方式で描きます。）</span>
                                        </div>
                                        <hr>
                                        <div style="text-align: center;">
                                            <span>以下から占いたい項目を選んでください。<br>AI占星術師アオポンがあなたのホロスコープから占います。</span>
                                        </div>
                                        <hr>
                                        <!-- 占いボタン群 -->
                                        <div class="analysis-buttons">
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button1">性格</button>
                                                <div id="spinner1" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button2">恋愛運</button>
                                                <div id="spinner2" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button3">仕事運</button>
                                                <div id="spinner3" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button4">金運</button>
                                                <div id="spinner4" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button5">健康運</button>
                                                <div id="spinner5" class="spinner"></div>
                                            </div>
                                            <div class="analysis-button">
                                                <button type="submit" id="submit-button6">学業運</button>
                                                <div id="spinner6" class="spinner"></div>
                                            </div>
                                        </div>
                                        <br>
                                        <hr>
                                        <div class="analysis-buttons">
                                            <div  class="analysis-button">
                                                <button type="submit" id="submit-button9" class="new-badge">今日の運勢</button>
                                                <div id="spinner9" class="spinner"></div>                                                
                                            </div>
                                            <div  class="analysis-button">
                                                <button type="submit" id="submit-button10" class="new-badge">今年の運勢</button>
                                                <div id="spinner10" class="spinner"></div>                                                
                                            </div>
                                        </div>
                                    </div>
                                    <small>※AIがその都度鑑定を行うため、30秒~3分ほどかかります。</small>
                                    
                                    <!-- 占い結果表示 -->
                                    <div id="result">AIの回答がここに表示されます</div>
                                    
                                    <hr>
                                    <div id="ad-banner">
                                        <div class="desktop-ad">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+8KELOI+2PEO+C4LLD" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250202141518&wid=003&eno=01&mid=s00000012624002037000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www12.a8.net/0.gif?a8mat=44YP7H+8KELOI+2PEO+C4LLD" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www21.a8.net/svt/bgt?aid=250202141788&wid=003&eno=01&mid=s00000012624008024000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www16.a8.net/0.gif?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250203147212&wid=003&eno=01&mid=s00000012748002004000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" alt="">
                                        </div>
                                        <div class="mobile-ad">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+8KELOI+2PEO+C4LLD" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250202141518&wid=003&eno=01&mid=s00000012624002037000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www12.a8.net/0.gif?a8mat=44YP7H+8KELOI+2PEO+C4LLD" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www21.a8.net/svt/bgt?aid=250202141788&wid=003&eno=01&mid=s00000012624008024000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www16.a8.net/0.gif?a8mat=44YP7H+D15N0I+2PEO+1BRTKX" alt="">
                                            <a href="https://px.a8.net/svt/ejp?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" rel="nofollow">
                                            <img border="0" width="300" height="250" alt="" src="https://www29.a8.net/svt/bgt?aid=250203147212&wid=003&eno=01&mid=s00000012748002004000&mc=1"></a>
                                            <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=44YPZF+3I7YKI+2QD4+BXIYP" alt="">
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <hr>
                                    <a id="howtouse"></a>
                                    <div>
                                        <h3>このサイトの利用方法</h3>
                                        <div>
                                            <p>1.占いたい人の生年月日、出生時刻、出生地を入力します。（出生時刻が分からない場合は不明にチェックを入れてください。）</p>
                                            <p>2.すると自動的にホロスコープが作成されます。</p>
                                            <p>3.ホロスコープの詳細を見たい場合は、ホロスコープの詳細ボタンを押してください。大きなホロスコープを見ることができます。</p>
                                            <p>4.その後、占いたい項目をカラフルな8つのボタンから選択してください。</p>
                                            <p>5.ボタンを押すとAIが<strong>惑星の配置だけに基づいて</strong>、解析結果を占ってくれます。</p>
                                            <p>この解析結果の作成にはOpenAIのAPIを利用しています。</p>
                                        </div>
                                        <br>
                                        <br>
                                        <hr>
                                        <h3>AIを使ったオーダーメイドな使い方</h3>
                                        <div>
                                            <p>1.生年月日等入力後ホロスコープの詳細（AI用）ボタンを押します。</p>
                                            <p>2.出てきたJSONデータをコピーして、お好きなAI（ChatGPT、Gemini、Grok等）に貼り付けます。</p>
                                            <p>（日本語で読める形式で張り付けたほうがいいと思います。ブラウザによって、この方法は異なります。）
                                            <br>（また、ChatGPTなどのサイトは各自でアクセスしてください。）</p>
                                            <p>3.チャット欄の先頭に「以下のホロスコープの人の【聞きたいこと】（運勢など）を教えて」と入力します。</p>
                                            <p>4.するとホロスコープに基づいた分析を占ってくれます。</p>
                                            <p>5.チャット形式なので、他にも聞きたいことを続けて聞くことができます。自分の聞きたいAIに自分の好きな質問ができます。</p>
                                            <p>おすすめはOpenAIのo1とGPT-4.5です。また、Grok3も比較的正確に返してくれます。</p>
                                        </div>
                                    </div>

                                    <div id="ad-banner">
                                        <div class="desktop-ad">
                                            
                                        </div>
                                        <div class="mobile-ad">
                                            
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="horoscope-sample"></a>
                                    <hr>
                                    <div>
                                        <h3>ホロスコープのサンプル（大谷翔平さん）</h3>
                                        <div>
                                            <p>以下に例として1994/7/5 21:05 岩手県生まれの大谷翔平さんのホロスコープのサンプルを表示します。</p>
                                            <p>このように見やすいホロスコープが作れます。</p>
                                        </div>
                                        <div style="text-align: center;">
                                            <img src="{% static 'path/to/horoscope-otani.png' %}" alt="horoscope demo image">
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="analysis-sample1"></a>
                                    <hr>
                                    <div>
                                        <h3>AIによる分析結果のサンプル（大谷翔平さん）性格</h3>
                                        <div>
                                            <p>同様に例として大谷翔平さんの性格を占った結果を載せます。</p>
                                            <p>このように分かりやすい解析結果が得られます。</p>
                                            <p>「他者に対して理想主義的で友好的な姿勢がある一方、独自の価値観や個性を大切にするため、周囲と一線を画すこともあります。」という点なんかは二刀流をイメージさせてくれます。</p>
                                        </div>
                                    </div>
                                    <div id="result-sample1" class="result-sample">
                                        <p>このネイタルチャートから見ると、この方は知的な好奇心と人道的な独自性を持ちながら、内面的には感受性豊かで家族や安心感を大切にする、複雑で多面的な性格をお持ちだと考えられます。</p>
                                        <p>◆ アセンダント（上昇星座：水瓶座）<br>外面的な印象は、個性的でオープンマインド、そして革新的な考え方にあふれています。自由を重んじ、他者に対して理想主義的で友好的な姿勢がある一方、独自の価値観や個性を大切にするため、周囲と一線を画すこともあります。</p>
                                        <p>◆ 太陽（蟹座・第5ハウス）<br>太陽が蟹座に位置しているため、心の奥底では温かみや保護本能、家庭や親しい人たちへの深い愛情を持っています。第5ハウスに太陽があることから、創造性や自己表現、そして人との深い情愛関係を楽しむ傾向があります。感情豊かで、安心できる環境や大切な人との結びつきを何よりも重視します。</p>
                                        <p>◆ 月（双子座・第3ハウス）＆ 火星（双子座・第3ハウス）＆ 水星（双子座・第4ハウス）<br>月が双子座にあるため、心は常に動き、情報交換やコミュニケーションを通じて感情を表現する傾向があります。火星も双子座にあるため、思考や会話の中でエネルギッシュに自己主張する面が見られるでしょう。さらに、水星が双子座にあることで、知的な鋭さや柔軟な思考、好奇心旺盛な一面を持ち、家庭や内面世界（第4ハウス）でも活発な情報活動が行われると考えられます。これらの配置は、机上の知識だけでなく、日常生活の中で絶えず刺激を求め、変化に対応していく柔軟さを示しています。</p>
                                        <p>◆ 金星（獅子座・第6ハウス）＆ アスペクトの影響<br>金星が獅子座にあることは、愛情表現や美意識、そして人との関係において、誇り高く情熱的な面があることを示しています。しかし、金星と冥王星とのスクエアというアスペクトは、恋愛や対人関係において、強烈な感情や権力闘争、執着の傾向も見られるかもしれません。愛情表現において一層のドラマ性や深みが生まれ、時に激しい感情の起伏を経験することもあるでしょう。</p>
                                        <p>◆ 木星（蠍座・第8ハウス）＆ 冥王星（蠍座・第9ハウス）<br>木星が蠍座に位置し第8ハウスにあるため、深い変容や精神的な成長、さらには他者との間での信頼や資源の共有に恵まれる面があります。一方、冥王星も蠍座にあるため、人生の意味や哲学を根底から見つめ直し、極めて変革的な経験を通して自己再生を遂げる傾向があります。特に冥王星が第9ハウスにあることは、人生観や信念、学びにおいて大きな変革の力をもたらすでしょう。</p>
                                        <p>◆ 土星（魚座・第1ハウス）と天王星・海王星（いずれも山羊座、第12・第11ハウス）<br>土星が魚座にありながら第1ハウスに現れているため、自己表現や自分自身の立ち位置について、慎重さや内省的な姿勢が伴います。自分自身に対して厳しい面もありますが、その分、他者への共感や思いやりが深まる傾向もあります。加えて、天王星と海王星が山羊座にあり、特にコンジャンクションの配置やセクスタイルのアスペクトにより、革新性と理想主義が組み合わされ、社会的な役割や集団の中で新しい秩序を模索する姿勢が強調されています。これにより、現実的な枠組みの中で、理想を実現しようとするチャレンジ精神が見受けられます。</p>
                                        <p>◆ 総合的な印象<br>・知的でコミュニケーション能力が高く、常に新しい知識や情報に触れたいという欲求が強い。<br>・感受性と情熱が豊かで、家族や身近な人たちへの愛情、そして自己表現を大切にする。<br>・一方で、内面にはトラウマや深い変革の経験が潜んでおり、それを乗り越えることで人間的な奥行きが増している。<br>・対人関係や恋愛においては、情熱的でドラマティックな面があり、時にパワフルな葛藤を生むこともあるが、その分成長の糧としている。<br>・自己の内面と外面的な表現とのバランスを取りながら、独自の道を歩む強い意志と柔軟性を持っている。</p>
                                        <p>総じて、このチャートを持つ方は、柔軟で知性的、かつ情熱的な人柄であり、自己表現や対人関係、また人生の深いテーマに対して真剣に向き合う姿勢が見られます。内面の感受性と外側の革新的なエネルギーが混ざり合い、個性的な魅力と共に、困難を乗り越えながら成長していく力強さがあると感じられます。</p>
                                    </div>
                                    
                                    <br>
                                    <br>
                                    <a id="analysis-sample2"></a>
                                    <hr>
                                    <div>
                                        <h3>AIによる分析結果のサンプル（大谷翔平さん）仕事運</h3>
                                        <div>
                                            <p>続けて例として大谷翔平さんの仕事運を占った結果を載せます。</p>
                                            <p>このように分かりやすい解析結果が得られます。</p>
                                            <p>「国際的な分野」で才能を発揮するとか、「個性豊かで多才な才能を持ち、変化と成長を遂げやすい運勢」という点なんかはイメージの通りだなと思いました。</p>
                                        </div>
                                    </div>

                                    <div id="result-sample2" class="result-sample">
                                        <p>このチャートから読み取れる仕事運は、個性豊かで多才な才能を持ち、変化と成長を遂げやすい運勢と言えます。具体的なポイントをいくつか挙げながら解説いたします。</p>
                                        <p>■【キャリアの方向性と目標】<br>・ミッドヘヴェン（MC）が射手座にあるため、仕事に対しては広い視野と高い理想、そして探究心や冒険心が強く表れます。教育、国際的な分野、旅行関連、出版やメディアなど、視野を広げる環境で才能を発揮しやすいでしょう。<br>・射手座MCは、先を見据えた企画や戦略、哲学的・精神的な領域で活躍する傾向も示唆しており、自らの理想や価値観を実現するための道を歩む可能性があります。</p>
                                        <p>■【才能とコミュニケーション能力】<br>・月、水星、火星が双子座や第3ハウスに位置しているため、コミュニケーション能力や情報の発信力、学びや伝達に優れています。文章や話し方、交渉力を活かす職場環境で、周囲との連携や迅速な判断ができる点は大きな武器となるでしょう。<br>・この配置は、人との情報のやり取りやネットワーク作り、チームワークを要求される職種にも適しています。</p>
                                        <p>■【自己管理と実務力】<br>・太陽が蟹座で第5ハウスにあり、創造性や感受性が豊かなと同時に、太陽と土星のトラインもあることから、感情面だけでなく現実的な判断力、自己管理能力、計画性が備わっています。<br>・土星は第1ハウスにあるため、自分自身のイメージや印象、仕事に対する責任感も強く、地道な努力を続ける力があります。これが、長期的なキャリア形成や結果を出すための基盤となるでしょう。</p>
                                        <p>■【パワーと変革の要素】<br>・金星と冥王星とのスクエア、さらに火星と冥王星のオポジションといったアスペクトは、職場内でのパワーバランスや対人関係での強い衝突、時には感情的な対立などのテーマが現れることを示唆しています。<br>・こうした要素は、時に試練や競争、権力闘争の形で現れるかもしれませんが、一方で深い変革や自己成長、内面の強化にもつながる可能性があります。対立や緊張を上手にマネージメントするスキルが求められるため、柔軟な対応や自己分析、交渉術を磨くことが大切です。</p>
                                        <p>■【資源運用・変革のチャンス】<br>・木星が蠍座の第8ハウスにあることは、他者の資源や金融面、投資、研究、心理学的なアプローチなど、通常の枠を超えたリソースの活用によって成長できる運勢を示しています。<br>・危機や転機をチャンスに変える力も持っており、予想外の出来事から学んで自らのキャリアを進化させる可能性があります。</p>
                                        <p>■【まとめ】<br>このチャートは、仕事において高い理想と広い視野を持ちながらも、コミュニケーション力や実務能力で着実に成果を出す土台があることを示しています。同時に、職場における人間関係やパワーバランスの摩擦といった試練も訪れる可能性があるため、柔軟かつ内省的に対処することが求められます。全体として、理想と現実を結びつけ、自己成長を追求するキャリアが開ける運勢といえるでしょう。</p>
                                    </div>
                                    <br>
                                    <br>
                                    <a id="horoscope-meaning"></a>
                                    <hr>
                                    <div>
                                        <div class="horoscope-meaning">
                                            <h3>コラム</h3>
                                            <h3>ホロスコープという統計的知恵：星々が紡ぐデータの物語</h3>
                                            <p>古来より、私たちは夜空に輝く星々に神秘的な意味を見出してきました。占星術は、単なる迷信や偶然の羅列ではなく、何世紀にもわたる観察と経験が積み重ねられた「統計的な知恵」であると私は考えています。ここでは、ホロスコープがどのようにして統計的な視点を内包しているのか、その奥深さについて考察してみたいと思います。</p>
                                            <br>
                                            <h4>1. 星々の配置と人間模様の繰り返し</h4>
                                            <p>占星術の根底には、天体の動きと人間の生活・性格との間に見出されるパターンがあります。例えば、太陽や月、主要な惑星が配置される12のハウスや、黄道十二宮に象徴される性質は、実際の人間関係や性格の傾向としばしば対応すると言われています。これは、個々のホロスコープが、無数の人々の生活経験から抽出された統計的傾向の反映であるという見方ができます。長い年月をかけて、多くの占星家たちが観察と記録を重ね、ある種の「データベース」を築いてきた結果なのです。</p>
                                            <br>
                                            <h4>2. 統計的知見としての占星術</h4>
                                            <p>現代の統計学では、膨大なデータの中からパターンや傾向を見出す手法が確立されています。同様に、占星術も星の配置という宇宙規模の「データ」を通して、人間の性格や運命に関するパターンを読み解こうとする試みと言えるでしょう。たとえば、ある惑星が特定のハウスにあるときに、どのような傾向が現れるのかというのは、過去の経験や観察結果をもとにした「統計的相関」のように理解することができます。もちろん、現代科学の統計解析とは手法も精度も異なるかもしれませんが、根底にある「パターン認識」という点では共通しています。</p>
                                            <br>
                                            <h4>3. 経験とデータが紡ぐ占星術の実践</h4>
                                            <p>私自身、長年にわたりホロスコープを読み解く中で、多くの「偶然ではなく必然」が重なり合う瞬間を目の当たりにしてきました。それは、星々の配置が、個々人の人生の節目や性格の傾向と驚くほど一致する場面です。これらの経験は、単なる感覚的なものではなく、数多くの事例に裏付けられた統計的な傾向として蓄積されています。実際に、ある惑星の影響下にあるとされる時期に、多くの人々が同様の変化や決断を経験するという現象は、偶然の産物と断じがたいほどの再現性を持っています。</p>
                                            <br>
                                            <h4>4. ホロスコープのシンボリズムと統計的事実</h4>
                                            <p>占星術はシンボリズムの芸術とも言えますが、そのシンボルの背後には、長い年月にわたって検証され続けた統計的事実が潜んでいます。たとえば、牡羊座、蟹座、天秤座などの星座は、それぞれ異なる性格や行動パターンを示すとされ、その特徴は多くの人々の実体験に基づいています。これらのシンボルは、抽象的なイメージに留まらず、実際の人間の行動や傾向を統計的に捉えた結果として生まれたものと見ることができるのです。</p>
                                            <br>
                                            <h4>5. 統計的知恵としての占星術の未来</h4>
                                            <p>現代においても、膨大な情報とデータが飛び交う中で、占星術が提供する統計的知恵は、新たな視点を私たちに示してくれます。データサイエンスやビッグデータの時代において、古代から伝わるパターン認識の技術は、心理学や社会学など他の分野との融合により、更なる可能性を秘めています。占星術のシステムは、個々人の傾向や未来の動向を読み解くための一つのフレームワークとして、現代の統計的手法と共鳴し合う未来が期待されます。</p>
                                            <br>
                                            <h4>結び</h4>
                                            <p>ホロスコープは、単なる未来予言や運命論ではなく、数世紀にわたる経験と観察から得られた統計的知恵の結晶です。星々の配置が示すパターンは、私たち人間の多様な性格や行動を理解するための一つの有用なツールとして、今後も進化し続けるでしょう。統計学的な視点から占星術を捉え直すことで、より深い洞察と新たな可能性が広がると私は信じています。</p>
                                            <br>
                                            <p>星空の下で、私たち一人ひとりが持つ物語は、確かなパターンの中に静かに刻まれているのです。</p>
                                        </div>
                                    </div>

                                </form>


                            </div>
                            
                            
                        </div>
                    </div>
                </main>
            </div> <!-- .layout-wrapper -->
            
        </div>


        <!-- (A) 時刻不明チェックボックスの自動処理 -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const timeInput = document.getElementById('time');
                const unknownCheckbox = document.getElementById('unknown');
            
                unknownCheckbox.addEventListener('change', function () {
                    if (this.checked) {
                        timeInput.value = '';
                    } else {
                        // timeInput.value = '';
                    }
                });
            });
        </script>

        <!-- (C) クッキー周りのヘルパー関数 (必要な場合) -->
        <script>
            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + (days*24*60*60*1000));
                const expires = "expires="+ d.toUTCString();
                document.cookie = `${name}=${value};${expires};path=/`;
            }
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>

        <!-- (D) フォームの入力値をクッキーに保存＆復元 (必要に応じて) -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const yearSelect = document.getElementById('year-select');
                const monthSelect = document.getElementById('month-select');
                const daySelect = document.getElementById('day-select');
                const timeInput = document.querySelector('input[name="time"]');
                const prefectureSelect = document.getElementById('prefecture');
                const checkboxSelect = document.getElementById('unknown');

                // クッキーから読み込む例 (省略可)
                const savedYear = getCookie('horoscope_year');
                const savedMonth = getCookie('horoscope_month');
                const savedDay = getCookie('horoscope_day');
                const savedTime = getCookie('horoscope_time');
                const savedPrefecture = getCookie('horoscope_prefecture');
                const savedCheckbox = getCookie('horoscope_checkbox');

                if (yearSelect && savedYear) {
                    yearSelect.value = savedYear;
                }
                if (monthSelect && savedMonth) {
                    monthSelect.value = savedMonth;
                }
                if (daySelect && savedDay) {
                    daySelect.value = savedDay;
                }
                if (timeInput && savedTime !== null) {
                    timeInput.value = savedTime;
                }
                if (checkboxSelect && savedCheckbox !== null) {
                    checkboxSelect.checked = (savedCheckbox === 'true');
                }
                if (prefectureSelect && savedPrefecture) {
                    const options = prefectureSelect.options;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i].value === savedPrefecture) {
                            prefectureSelect.selectedIndex = i;
                            break;
                        }
                    }
                }

                // デフォルト値の設定（Cookieに該当値がない場合のみ）
                if (!savedYear || !savedMonth || !savedDay) {
                    const now = new Date();
                    if (yearSelect && !savedYear)  yearSelect.value  = now.getFullYear();
                    if (monthSelect && !savedMonth) monthSelect.value = String(now.getMonth() + 1);
                    if (daySelect && !savedDay)     daySelect.value   = String(now.getDate());
                }
                if (!savedTime && savedCheckbox == null) {
                    const now = new Date();
                    const hours   = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    if (timeInput) timeInput.value = `${hours}:${minutes}`;
                }
                // 都道府県切り替え
                if (prefectureSelect) {
                    function updateLatLon(e) {
                        const selected = e.target.selectedOptions[0];
                        document.getElementById('lat').value = selected.getAttribute('data-lat');
                        document.getElementById('lon').value = selected.getAttribute('data-lon');
                    }
                    // 初期化
                    const defaultSelected = prefectureSelect.selectedOptions[0];
                    document.getElementById('lat').value = defaultSelected.getAttribute('data-lat');
                    document.getElementById('lon').value = defaultSelected.getAttribute('data-lon');
                    // 変更イベント
                    prefectureSelect.addEventListener('change', updateLatLon);
                }
            });
        </script>
        
        <!-- (E) フォーム送信（ボタンクリック）本番運用 -->
        <script>
            
            // Django等でCSRFトークンがセットされている想定
            const csrftoken = getCookie('csrftoken');
            
            // 送信ボタンの要素（例: 3つのボタン）
            const submitButtons = [
            document.getElementById('submit-button1'),
            document.getElementById('submit-button2'),
            document.getElementById('submit-button3'),
            document.getElementById('submit-button4'),
            document.getElementById('submit-button5'),
            document.getElementById('submit-button6'),
            document.getElementById('submit-button9'),
            document.getElementById('submit-button10')
            ];
            const resultDiv = document.getElementById('result');

            // フォームデータをオブジェクトに変換するヘルパー関数
            const formDataToObject = formData => {
                const data = {};
                formData.forEach((value, key) => data[key] = value);
                return data;
            };
            
            // クッキーに保存する関数
            function saveFormDataToCookies(formData) {
                const data = formDataToObject(formData);
                setCookie('horoscope_year', data.year, 30); // 30日間有効
                setCookie('horoscope_month', data.month, 30); // 30日間有効
                setCookie('horoscope_day', data.day, 30); // 30日間有効
                setCookie('horoscope_time', data.time, 30);
                setCookie('horoscope_prefecture', data.prefecture, 30);
                
                // チェックボックスの状態を 'true' または 'false' で保存
                const isChecked = formData.has('unknown') ? 'true' : 'false';
                setCookie('horoscope_checkbox', isChecked, 30);
            }
            
            // 送信ハンドラー生成関数
            const createSubmitHandler = (sbValue, spinnerId) => async e => {
                e.preventDefault();
                
                const form = e.target.form;
                if (!form) return;

                try {
                    // フォームデータ処理
                    const formData = new FormData(form);
                    const data = formDataToObject(formData);
                    
                    // 日付と時刻の分解
                    // const [year, month, day] = data.date.split('-');
                    const year = data.year;
                    const month = data.month;
                    const day = data.day;
                    const time  = data.time || "12:00";
                    const [hour, minute] = time.split(':');
                    const unknown = data.unknown;
                    const prefecture = data.prefecture;

                    // 送信データの組み立て
                    const sendData = {
                        year: year,
                        month: month,
                        day: day,
                        hour: hour,
                        minute: minute,
                        lat: data.lat,
                        lon: data.lon,
                        tz: data.tz,
                        dst: data.dst,
                        sb: sbValue,
                        unknown: unknown,
                        prefecture: prefecture
                    };

                    // UI状態更新
                    submitButtons.forEach(btn => btn.disabled = true);
                    const spinner = document.getElementById(spinnerId);
                    if (spinner) spinner.style.display = 'inline-block';

                    // APIリクエスト
                    const response = await fetch("{% url 'horoscope_app:analyze' %}", {
                    method: 'POST',
                    credentials: 'same-origin',  // これを追加
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': csrftoken
                    },
                    body: new URLSearchParams(sendData)
                    });

                    // レスポンス処理
                    const content = await response.json();
                    if (!response.ok) throw new Error(content.error || 'Unknown error');

                    // Markdown処理とサニタイズ
                    const cleanHtml = DOMPurify.sanitize(marked.parse(content.result));
                    resultDiv.innerHTML = cleanHtml;

                    // クッキーに保存
                    saveFormDataToCookies(formData);

                } catch (error) {
                    const errorMessage = error.name === 'SyntaxError' 
                    ? 'Invalid server response'
                    : error.message;
                    resultDiv.textContent = error.response ?
                     `エラー: ${error.message}` 
                    : `通信エラー: ${errorMessage}`;
                } finally {
                    submitButtons.forEach(btn => btn.disabled = false);
                    const spinner = document.getElementById(spinnerId);
                    if (spinner) spinner.style.display = 'none';
                }
            };

            // ボタン設定とイベントリスナーの登録
            const buttonConfigs = [
            { id: 'submit-button1', spinner: 'spinner1', sb: 1 },
            { id: 'submit-button2', spinner: 'spinner2', sb: 2 },
            { id: 'submit-button3', spinner: 'spinner3', sb: 3 },
            { id: 'submit-button4', spinner: 'spinner4', sb: 4 },
            { id: 'submit-button5', spinner: 'spinner5', sb: 5 },
            { id: 'submit-button6', spinner: 'spinner6', sb: 6 },
            { id: 'submit-button9', spinner: 'spinner9', sb: 9 },
            { id: 'submit-button10', spinner: 'spinner10', sb: 10 }
            ];

            buttonConfigs.forEach(({ id, spinner, sb }) => {
            const button = document.getElementById(id);
            if (button) {
                button.addEventListener('click', createSubmitHandler(sb, spinner));
            }
            });
        </script>
    

        <!-- (F) ホロスコープを生成・描画するスクリプト -->
        <script>
            // 惑星英名 => 惑星和名
            const planetNameMap = {
                "Sun"     : "太陽",
                "Moon"    : "月",
                "Mercury" : "水星",
                "Venus"   : "金星",
                "Mars"    : "火星",
                "Jupiter" : "木星",
                "Saturn"  : "土星",
                "Uranus"  : "天王星",
                "Neptune" : "海王星",
                "Pluto"   : "冥王星"
            };
            // 惑星英名 => シンボル
            const planetSymbolMap = {
                "Sun"     : "☉",
                "Moon"    : "☾",
                "Mercury" : "☿",
                "Venus"   : "♀",
                "Mars"    : "♂",
                "Jupiter" : "♃",
                "Saturn"  : "♄",
                "Uranus"  : "♅",
                "Neptune" : "♆",
                "Pluto"   : "♇"
            };
            // アスペクト色（高級感のある金・銀・深紅・濃緑・ダークゴールド）
            const aspectColorMap = {
                "コンジャンクション": "#FFD700",  // 明るいゴールド（ゴールド）
                "オポジション": "#0000FF",        // ブルー（青）
                "スクエア": "#FF6347",            // 明るいレッド（トマトレッド）
                "トライン": "#32CD32",            // 明るいグリーン（ライムグリーン）
                "セクスタイル": "#FFCC33",        // 明るいゴールデンロッド（ライトゴールデンロッド）
                "Conjunction": "#FFD700",
                "Opposition": "#0000FF",
                "Square": "#FF6347",
                "Trine": "#32CD32",
                "Sextile": "#FFCC33"
            };
            // 星座のシンボル
            const zodiacSymbols = {
                0: "♈", 1: "♉", 2: "♊", 3: "♋",
                4: "♌", 5: "♍", 6: "♎", 7: "♏",
                8: "♐", 9: "♑", 10: "♒", 11: "♓"
            };

            /**
             * ホロスコープを描画する関数
             * @param {Object} horoscopeData サーバー等から取得したホロスコープ情報
             */
            function drawHoroscopeWheel(horoscopeData) {
                const chartContainer = document.getElementById('chart-container');
                const canvas = document.getElementById('horoscope-canvas');

                // canvas のサイズ調整
                let containerWidth = chartContainer.offsetWidth; 
                if (containerWidth > 386) {
                    containerWidth = 386; 
                }
                canvas.width = containerWidth;
                canvas.height = containerWidth;
                chartContainer.style.width  = containerWidth + "px";
                chartContainer.style.height = containerWidth + "px";

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius  = canvas.width * 0.4;

                // ハウスデータの処理（rotationOffset 等）
                const houseData = horoscopeData?.raw_data?.houses;
                let rotationOffset = 0;
                if (houseData && houseData.cusp && houseData.cusp.length > 0) {
                    const firstCuspDeg = houseData.cusp[0];
                    rotationOffset = (90 - firstCuspDeg) % 360;
                }
                function degToRad(deg) {
                    return (360 - (deg + rotationOffset) - 90) * Math.PI / 180;
                }

                // 背景グラデーション（中心から薄い青がかかるグラデーション）
                const bgGradient = ctx.createRadialGradient(
                    centerX, centerY, 0,
                    centerX, centerY, radius * 1.5
                );
                bgGradient.addColorStop(0,   "#f0f8ff");
                bgGradient.addColorStop(0.7, "#cceeff");
                bgGradient.addColorStop(1,   "#99bbff");
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 外円描画（ゴールドの外枠）
                ctx.save();
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius + 10, 0, 2 * Math.PI);
                ctx.shadowColor = 'rgba(30, 144, 255, 0.5)'; // 濃い青色のシャドウ
                ctx.shadowBlur = 10;
                ctx.strokeStyle = '#E0FFFF'; // プラチナシルバー
                ctx.lineWidth = 4;
                ctx.stroke();
                ctx.restore();

                // ハウス線とハウス番号（ハウス番号の色を黒に変更）
                if (houseData && houseData.cusp) {
                    for (let i = 0; i < houseData.cusp.length; i++) {
                        const cuspAngleDeg = houseData.cusp[i];
                        const angleRad = degToRad(cuspAngleDeg);

                        const x2 = centerX + (radius + 10) * Math.cos(angleRad);
                        const y2 = centerY + (radius + 10) * Math.sin(angleRad);

                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.lineTo(x2, y2);
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)'; // 黒
                        ctx.lineWidth = 1;
                        ctx.setLineDash([6, 4]); // 点線
                        ctx.stroke();
                        ctx.restore();

                        // ハウス番号を白で描画
                        const labelRadius = radius * 0.5;
                        const labelX = centerX + labelRadius * Math.cos(angleRad - 0.26);
                        const labelY = centerY + labelRadius * Math.sin(angleRad - 0.26);

                        ctx.save();
                        ctx.font = Math.floor(canvas.width * 0.025) + "px 'Times New Roman'";
                        ctx.fillStyle = "#000000"; // 黒
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText((i + 1).toString(), labelX, labelY);
                        ctx.restore();
                    }
                }

                // ★ 惑星配置
                const planets = horoscopeData?.raw_data?.planets;
                if (!planets) {
                    alert("惑星データが見つかりません。");
                    return;
                }
                const planetPositions = {};
                // drawnSymbols 配列は adjust 関数用（シンボル位置の調整用）
                const drawnSymbols = [];
                // planetSymbolsToDraw 配列にシンボル描画情報を保存し、後で最前面に描画する
                const planetSymbolsToDraw = [];

                /**
                 * adjust 関数
                 * 惑星シンボル同士が重なっている場合、元の位置から offset ずらした位置を返し、
                 * その位置と元の位置を線分で結びます。
                 *
                 * @param {CanvasRenderingContext2D} ctx - canvas のコンテキスト
                 * @param {number} x - 元の x 座標
                 * @param {number} y - 元の y 座標
                 * @param {number} angle - 惑星配置の角度 (ラジアン)
                 * @param {Array} drawnSymbols - 既に描画済みのシンボルの位置リスト
                 * @returns {Object} 調整後の {x, y} 座標
                 */
                function adjust(ctx, x, y, angle, drawnSymbols) {
                    const offsetStep = 30;         // 30px ずつずらす
                    let offset = 0;
                    let newX = x;
                    let newY = y;
                    const collisionThreshold = 15; // 中心間距離が15px未満なら重なっていると判定

                    while (true) {
                        let collision = false;
                        for (let pos of drawnSymbols) {
                            const dx = pos.x - newX;
                            const dy = pos.y - newY;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            if (distance < collisionThreshold) {
                                collision = true;
                                break;
                            }
                        }
                        if (!collision) {
                            break;
                        }
                        offset += offsetStep;
                        newX = x - offset * Math.cos(angle);
                        newY = y - offset * Math.sin(angle);
                        // 無限ループ防止のための上限
                        if (offset > 100) break;
                    }

                    // ずらしが発生していた場合、元の位置と調整後の位置を線分で結ぶ
                    if (offset > 0) {
                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(newX, newY);
                        ctx.strokeStyle = "rgba(255,255,255,0.5)";
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                        ctx.restore();
                    }
                    drawnSymbols.push({ x: newX, y: newY });
                    return { x: newX, y: newY };
                }

                // 各惑星の描画（惑星の円はそのまま描く）
                for (const planetName of Object.keys(planets)) {
                    const planetObj = planets[planetName];
                    if (planetObj.longitude === undefined) continue;
                    
                    let lonDeg = Array.isArray(planetObj.longitude)
                        ? planetObj.longitude[0]
                        : parseFloat(planetObj.longitude);
                    if (isNaN(lonDeg)) continue;
                    
                    const angleRad = degToRad(lonDeg);
                    const x = centerX + radius * Math.cos(angleRad);
                    const y = centerY + radius * Math.sin(angleRad);

                    // 惑星の円を描画（高級感のある色合い）
                    ctx.save();
                    ctx.beginPath();
                    ctx.arc(x, y, canvas.width * 0.008, 0, 2 * Math.PI);
                    let fillColor = '#dd3333';
                    switch (planetName) {
                        case 'Sun'     : fillColor = '#D4AF37'; break;  // ゴールド
                        case 'Moon'    : fillColor = '#C0C0C0'; break;  // シルバー
                        case 'Mercury' : fillColor = '#708090'; break;  // スレートグレー
                        case 'Venus'   : fillColor = '#B87333'; break;  // カッパー
                        case 'Mars'    : fillColor = '#8B0000'; break;  // ダークレッド
                        case 'Jupiter' : fillColor = '#CD7F32'; break;  // ブロンズ
                        case 'Saturn'  : fillColor = '#A67B5B'; break;  // ブロンズ系
                        case 'Uranus'  : fillColor = '#008080'; break;  // ティール
                        case 'Neptune' : fillColor = '#00008B'; break;  // ネイビー
                        case 'Pluto'   : fillColor = '#800080'; break;  // パープル
                    }
                    ctx.fillStyle = fillColor;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)'; // 黒色のシャドウ
                    ctx.shadowBlur = 6;
                    ctx.fill();
                    ctx.restore();

                    // adjust 関数でシンボルの位置を調整（重なりがあれば線分も描画）
                    const symbol = planetSymbolMap[planetName] || planetName;
                    const adjustedPos = adjust(ctx, x, y, angleRad, drawnSymbols);
                    // ※ 惑星シンボルは黒で描画（fillStyle を "#000000" に変更）
                    planetSymbolsToDraw.push({
                        symbol: symbol,
                        x: adjustedPos.x,
                        y: adjustedPos.y,
                        font: Math.floor(canvas.width * 0.08) + "px sans-serif",
                        fillStyle: "#000000" // 黒
                    });

                    planetPositions[planetName] = { x, y };
                }

                // ノード情報を取得
                const nodes = horoscopeData?.raw_data?.nodes;
                if (nodes && nodes["True Node"] && Array.isArray(nodes["True Node"].longitude)) {
                    const rawNodeLon = nodes["True Node"].longitude[0];
                    const nodeLon    = parseFloat(rawNodeLon);
                    if (!isNaN(nodeLon)) {
                        // ドラゴンヘッド（North Node）
                        const headDeg = nodeLon % 360;
                        // ドラゴンテイル（South Node）
                        const tailDeg = (headDeg + 180) % 360;

                        // 共通の描画関数
                        function drawNode(deg, symbol, fillColor) {
                            const angleRad = degToRad(deg);
                            const x = centerX + radius * Math.cos(angleRad);
                            const y = centerY + radius * Math.sin(angleRad);

                            // 円を描く
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(x, y, canvas.width * 0.008, 0, 2 * Math.PI);
                            ctx.fillStyle = fillColor;
                            ctx.shadowColor = 'rgba(0,0,0,0.3)';
                            ctx.shadowBlur = 6;
                            ctx.fill();
                            ctx.restore();

                            // シンボルを adjust して描画
                            const adjusted = adjust(ctx, x, y, angleRad, drawnSymbols);
                            planetSymbolsToDraw.push({
                                symbol: symbol,
                                x: adjusted.x,
                                y: adjusted.y,
                                font: Math.floor(canvas.width * 0.08) + "px sans-serif",
                                fillStyle: "#000000"
                            });

                            // 位置を planetPositions にも保存してアスペクト線で使う
                            planetPositions[symbol] = { x, y };
                        }

                        // ドラゴンヘッド：シンボル ☊、色を紫（例）に
                        drawNode(headDeg, "☊", "#800080");
                        // ドラゴンテイル：シンボル ☋、色を濃緑（例）に
                        drawNode(tailDeg, "☋", "#008000");
                    }
                }

                // アスペクト描画
                const aspects = horoscopeData?.analysis?.["4.アスペクトの結果"] || [];
                aspects.forEach(aspect => {
                    const planet1Ja = aspect.planet1;
                    const planet2Ja = aspect.planet2;
                    const aspectName = aspect.aspect;
                    let p1En = null, p2En = null;
                    for (const [en, ja] of Object.entries(planetNameMap)) {
                        if (ja === planet1Ja) p1En = en;
                        if (ja === planet2Ja) p2En = en;
                    }
                    // ② フォールバックでノードを symbol キーにマッピング
                    if (!p1En) {
                        if (planet1Ja === "ドラゴンヘッド")  p1En = "☊";
                        if (planet1Ja === "ドラゴンテイル") p1En = "☋";
                    }
                    if (!p2En) {
                        if (planet2Ja === "ドラゴンヘッド")  p2En = "☊";
                        if (planet2Ja === "ドラゴンテイル") p2En = "☋";
                    }
                    if (!p1En || !p2En) return;

                    const pos1 = planetPositions[p1En];
                    const pos2 = planetPositions[p2En];
                    if (!pos1 || !pos2) return;

                    let lineColor = aspectColorMap[aspectName] || "#AAAAAA"; // パステル調の色

                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(pos1.x, pos1.y);
                    ctx.lineTo(pos2.x, pos2.y);
                    ctx.strokeStyle = lineColor;
                    ctx.lineWidth = canvas.width * 0.002;
                    if (aspectName === "スクエア" || aspectName === "Square") {
                        ctx.setLineDash([5, 3]);
                    }
                    ctx.stroke();
                    ctx.restore();
                });

                const zodiacColors = [
                    "#FF0000", // Red (牡羊座)
                    "#808000", // Dark Yellow (牡牛座)　
                    "#008000", // Green (双子座)
                    "#0000FF", // Blue (蟹座)
                    "#FF0000", // Red (獅子座)
                    "#808000", // Dark Yellow (乙女座)　
                    "#008000", // Green (天秤座)
                    "#0000FF", // Blue (蠍座)
                    "#FF0000", // Red (射手座)
                    "#808000", // Dark Yellow (山羊座)　
                    "#008000", // Green (水瓶座)
                    "#0000FF", // Blue (魚座)
                ];

                // ★ 星座の区分線およびシンボルの描画（修正版）
                ctx.save();
                // 内側のホロスコープ円（radius）はそのまま利用
                // 内側の区分線の開始位置（ホロスコープ円から少し外側）
                const innerDividingRadius = radius + (canvas.width * 0.017);
                // 星座シンボルを描く半径（内側と外側の中間あたり）
                const zodiacSymbolRadius = radius + (canvas.width * 0.06);
                // 外側に描く大きな円の半径（星座シンボルの外側＋余白）
                const outerCircleRadius = zodiacSymbolRadius + (canvas.width * 0.03);
                
                for (let i = 0; i < 12; i++) {
                    // degToRad が反転しているので、開始角度と終了角度を入れ替えています
                    const startAngle = degToRad((i + 1) * 30);
                    const endAngle   = degToRad(i * 30);

                    ctx.beginPath();
                    // 外側円弧の開始点に移動
                    ctx.moveTo(
                        centerX + outerCircleRadius * Math.cos(startAngle),
                        centerY + outerCircleRadius * Math.sin(startAngle)
                    );
                    // 外側の円弧を描く（startAngle ～ endAngle）
                    ctx.arc(centerX, centerY, outerCircleRadius, startAngle, endAngle, false);
                    // 外側の円弧の終点と内側の円弧の開始点を直接結ぶ
                    ctx.lineTo(
                        centerX + innerDividingRadius * Math.cos(endAngle),
                        centerY + innerDividingRadius * Math.sin(endAngle)
                    );
                    // 内側の円弧を描く（endAngle ～ startAngle を逆方向に）
                    ctx.arc(centerX, centerY, innerDividingRadius, endAngle, startAngle, true);
                    // パスを閉じる（自動的に内側の円弧の終点と外側の円弧の開始点を結ぶ）
                    ctx.closePath();

                    // ctx.fillStyle = zodiacColors[i];
                    ctx.fill();
                }

                // ① 外側の大円の外周を描画（ゴールドのライン）
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerCircleRadius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#D4AF37';
                ctx.lineWidth = 4;
                ctx.stroke();

                // ② 星座区分線と星座シンボルの描画
                for (let i = 0; i < 12; i++) {
                    // 各星座の境界線の角度（0～360°）
                    const lineAngle = degToRad(i * 30);
                    // 区分線は内側（innerDividingRadius）から外側の大円（outerCircleRadius）まで
                    ctx.beginPath();
                    ctx.moveTo(
                        centerX + innerDividingRadius * Math.cos(lineAngle),
                        centerY + innerDividingRadius * Math.sin(lineAngle)
                    );
                    ctx.lineTo(
                        centerX + outerCircleRadius * Math.cos(lineAngle),
                        centerY + outerCircleRadius * Math.sin(lineAngle)
                    );
                    ctx.strokeStyle = "rgba(50, 50, 50, 0.8)"; // 濃いグレー
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    // 星座シンボルは区分線の中央あたりに配置（色を黒に変更）
                    const midAngleRad = degToRad(i * 30 + 15);
                    // シンボルを配置する半径は内側と外側の中間
                    const symbolRadius = (innerDividingRadius + outerCircleRadius) / 2;
                    const textX = centerX + symbolRadius * Math.cos(midAngleRad);
                    const textY = centerY + symbolRadius * Math.sin(midAngleRad);

                    ctx.save();
                    ctx.translate(textX, textY);
                    ctx.font = Math.floor(canvas.width * 0.05) + "px 'Segoe UI Symbol', 'Arial', sans-serif"; 
                    ctx.fillStyle = "#000000";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(zodiacSymbols[i], 0, 0);
                    ctx.restore();
                }
                ctx.restore();

                // ★ 最後に、保存しておいた惑星シンボルを再描画して最前面に表示（色を黒に変更）
                planetSymbolsToDraw.forEach(item => {
                    ctx.save();
                    ctx.font = item.font;
                    ctx.fillStyle = item.fillStyle;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(item.symbol, item.x, item.y);
                    ctx.restore();
                });
            }
        </script>


        
        <!-- (G2) 「ホロスコープを作成」の処理画面読み込み時 (本番データで描画) -->
        <script>
            document.addEventListener('DOMContentLoaded', async function() {
                // (1) フォームの入力からパラメータを生成
                const form = document.getElementById('horoscope-form');
                const formData = new FormData(form);
                const year  = formData.get('year');
                const month = formData.get('month');
                const day   = formData.get('day');
                const time  = formData.get('time') || "12:00";
                const prefecture = formData.get('prefecture');
                const lat   = formData.get('lat');
                const lon   = formData.get('lon');
                const tz    = formData.get('tz');
                const dst   = formData.get('dst');
    
                // 不明時刻の場合は hour, minute = '12:00' などで補正
                const [hour, minute] = time.split(':');
    
                // クエリパラメータを作成 (Django想定の例)
                const params = new URLSearchParams({
                    year, month, day,
                    hour, minute,
                    lat, lon,
                    tz, dst,
                    prefecture
                });
                // 例: /horoscope_app/horoscope/?year=...&month=... など
                // 実際のURLはサーバー側に合わせて修正してください
                const horoscopeUrl = "{% url 'horoscope_app:horoscope' %}?" + params.toString();
    
                // (2) fetch でサーバーからホロスコープデータを取得
                try {
                    const response = await fetch(horoscopeUrl, {
                        method: 'GET',
                    });
                    if (!response.ok) {
                        throw new Error("ホロスコープデータの取得に失敗しました");
                    }
    
                    const horoscopeData = await response.json();
    
                    // (3) モーダルを表示後、実際に描画
                    const chartContainer = document.getElementById('chart-container');
                    chartContainer.style.display = 'block';
                    drawHoroscopeWheel(horoscopeData);
                    saveFormDataToCookies(formData);
    
                } catch (err) {
                    alert(err.message);
                }
            });
        </script>
        <!-- 詳細画面へリンク -->
        <script>
            document.getElementById('view-button').addEventListener('click', function() {
              const form = document.getElementById('horoscope-form');
              const formData = new FormData(form);
              const year  = formData.get('year');
              const month = formData.get('month');
              const day   = formData.get('day');
              const time  = formData.get('time') || "12:00";
              const prefecture = formData.get('prefecture');
              const lat   = formData.get('lat');
              const lon   = formData.get('lon');
              const tz    = formData.get('tz');
              const dst   = formData.get('dst');
          
              const [hour, minute] = time.split(':');
          
              const params = new URLSearchParams({
                year, month, day,
                hour, minute,
                lat, lon,
                tz, dst,
                prefecture
              });
          
              const horoscopeUrl = "{% url 'horoscope_app:horoscope_detail' %}?" + params.toString();
              window.location.href = horoscopeUrl;
            });
        </script>
        <script>
            document.getElementById('ai-button').addEventListener('click', function() {
              const form = document.getElementById('horoscope-form');
              const formData = new FormData(form);
              const year  = formData.get('year');
              const month = formData.get('month');
              const day   = formData.get('day');
              const time  = formData.get('time') || "12:00";
              const prefecture = formData.get('prefecture');
              const lat   = formData.get('lat');
              const lon   = formData.get('lon');
              const tz    = formData.get('tz');
              const dst   = formData.get('dst');
          
              const [hour, minute] = time.split(':');
          
              const params = new URLSearchParams({
                year, month, day,
                hour, minute,
                lat, lon,
                tz, dst,
                prefecture,
                token: "{{ token }}" // ここでトークンを追加
              });
          
              const horoscopeUrl = "{% url 'horoscope_app:horoscope_ai' %}?" + params.toString();
              window.location.href = horoscopeUrl;
            });
        </script>
        <!-- 保存ボタン -->
        <script>
            function saveCanvasAsImage() {
            const canvas = document.getElementById('horoscope-canvas');
            const link = document.createElement('a');
            link.download = 'horoscope.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            }
        </script>

        <script>
            // 生年月日、出生時刻、出生地が変更されたときにホロスコープを更新する関数
            async function updateHoroscope() {
            const form = document.getElementById('horoscope-form');
            const formData = new FormData(form);
            const unknown = formData.get('unknown');  // チェックされている場合、通常 "on" が返る
  
            // unknown がチェックされているなら time をデフォルト値にする
            let time = formData.get('time');
            if (unknown) {
                time = "12:00";
            } else if (!time) {
                time = "12:00";
            }
        
            // 各入力値を取得（出生時刻が未入力の場合はデフォルトで "12:00" を設定）
            const year  = formData.get('year');
            const month = formData.get('month');
            const day   = formData.get('day');
            // const time  = formData.get('time') || "12:00";
            const prefecture = formData.get('prefecture');
            const lat   = formData.get('lat');
            const lon   = formData.get('lon');
            const tz    = formData.get('tz');
            const dst   = formData.get('dst');
        
            // 時刻の分解（"hh:mm" 形式）
            const [hour, minute] = time.split(':');
        
            // クエリパラメータの作成（サーバー側のホロスコープデータ取得用URLに付加）
            const params = new URLSearchParams({
                year, month, day,
                hour, minute,
                lat, lon,
                tz, dst,
                prefecture
            });
        
            // Django側のホロスコープ取得用URL（適宜サーバー側のURLに合わせてください）
            const horoscopeUrl = "{% url 'horoscope_app:horoscope' %}?" + params.toString();
        
            try {
                // GETリクエストでホロスコープデータを取得
                const response = await fetch(horoscopeUrl, { method: 'GET' });
                if (!response.ok) {
                throw new Error("ホロスコープデータの取得に失敗しました");
                }
                const horoscopeData = await response.json();
        
                // ホロスコープ描画エリアを表示して描画関数を呼び出す
                const chartContainer = document.getElementById('chart-container');
                chartContainer.style.display = 'block';
                drawHoroscopeWheel(horoscopeData);
                saveFormDataToCookies(formData);
            } catch (error) {
                console.error(error.message);
            }
            }
        
            // 以下の各入力項目で変更があった際に updateHoroscope 関数を呼び出す
            document.getElementById('year-select').addEventListener('change', updateHoroscope);
            document.getElementById('month-select').addEventListener('change', updateHoroscope);
            document.getElementById('day-select').addEventListener('change', updateHoroscope);
            document.getElementById('time').addEventListener('change', updateHoroscope);
            document.getElementById('unknown').addEventListener('change', updateHoroscope);
            // 既存の prefecture 変更時の処理を統合する例
            document.getElementById('prefecture').addEventListener('change', function(e) {
            const selected = e.target.selectedOptions[0];
            // 緯度・経度を更新
            document.getElementById('lat').value = selected.getAttribute('data-lat');
            document.getElementById('lon').value = selected.getAttribute('data-lon');

            // 更新された隠しフィールドの値を使ってホロスコープを再描画
            updateHoroscope(); // または updateHoroscope() を直接呼び出す
            });
        </script>
  
  
    </body>
</html>
